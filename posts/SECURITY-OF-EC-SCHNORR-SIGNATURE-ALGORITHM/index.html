<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="SECURITY OF EC-SCHNORR SIGNATURE ALGORITHM" /><meta name="author" content="Vishvesh" /><meta property="og:locale" content="en" /><meta name="description" content="A minimal, portfolio, sidebar, bootstrap Jekyll theme with responsive web design and focuses on text presentation." /><meta property="og:description" content="A minimal, portfolio, sidebar, bootstrap Jekyll theme with responsive web design and focuses on text presentation." /><link rel="canonical" href="https://vishvesh-rao.github.io/posts/SECURITY-OF-EC-SCHNORR-SIGNATURE-ALGORITHM/" /><meta property="og:url" content="https://vishvesh-rao.github.io/posts/SECURITY-OF-EC-SCHNORR-SIGNATURE-ALGORITHM/" /><meta property="og:site_name" content="Stryd3r" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-22T20:30:06+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="SECURITY OF EC-SCHNORR SIGNATURE ALGORITHM" /><meta name="twitter:site" content="@The_Str1d3r" /><meta name="twitter:creator" content="@Vishvesh" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Vishvesh"},"description":"A minimal, portfolio, sidebar, bootstrap Jekyll theme with responsive web design and focuses on text presentation.","url":"https://vishvesh-rao.github.io/posts/SECURITY-OF-EC-SCHNORR-SIGNATURE-ALGORITHM/","@type":"BlogPosting","headline":"SECURITY OF EC-SCHNORR SIGNATURE ALGORITHM","dateModified":"2022-01-25T02:15:53+08:00","datePublished":"2022-01-22T20:30:06+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://vishvesh-rao.github.io/posts/SECURITY-OF-EC-SCHNORR-SIGNATURE-ALGORITHM/"},"@context":"https://schema.org"}</script><title>SECURITY OF EC-SCHNORR SIGNATURE ALGORITHM | Stryd3r</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Stryd3r"><meta name="application-name" content="Stryd3r"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://codimd.s3.shivering-isles.com/demo/uploads/02a6da1fb9d19367162f423a3.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Stryd3r</a></div><div class="site-subtitle font-italic">~Vishvesh, 21.y.o ~Blockchain security ~@team bi0s</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-user-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/presentations/" class="nav-link"> <i class="fa-fw fas fa-play ml-xl-3 mr-xl-3 unloaded"></i> <span>TALKS/PRESENTATIONS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/resume/" class="nav-link"> <i class="fa-fw fas fa-folder fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>RESUME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/Vishvesh-rao" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/The_Str1d3r" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['vishveshsrao','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>SECURITY OF EC-SCHNORR SIGNATURE ALGORITHM</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>SECURITY OF EC-SCHNORR SIGNATURE ALGORITHM</h1><div class="post-meta text-muted"><div> By <em> <a href="https://www.linkedin.com/in/vishvesh-rao-847368191">Vishvesh_R</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-01-22 20:30:06 +0800" data-toggle="tooltip" data-placement="bottom" title="Sat, Jan 22, 2022, 8:30 PM +0800" >Jan 22, 2022</em> </span> <span> Updated <em class="timeago" date="2022-01-24 23:45:53 +0530 " data-toggle="tooltip" data-placement="bottom" title="Mon, Jan 24, 2022, 11:45 PM +0530" >Jan 24, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3459 words"> <em>19 min</em> read</span></div></div></div><div class="post-content"><html><head> <script type="text/javascript" async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"> </script> <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML"> MathJax.Hub.Config({ "HTML-CSS": { availableFonts: ["TeX"], }, tex2jax: { inlineMath: [['$','$'],["\\(","\\)"]]}, displayMath: [ ['$$','$$'], ['\[','\]'] ], TeX: { extensions: ["AMSmath.js", "AMSsymbols.js", "color.js"], equationNumbers: { autoNumber: "AMS" } }, showProcessingMessages: false, messageStyle: "none", imageFont: null, "AssistiveMML": { disabled: true } }); </script><p>Recently Elliot ( a.k.a <a href="https://twitter.com/robot__dreams">@robot__dreams</a> ) published some crypto/bitcoin related challenges on the EC-schnorr algorithm and key sharing algorithm used to secure bitcoin wallets.</p><p>This blog post is my detailed explanation of my approach in solving all the challenges.</p><p>We will start with some basics about the EC-schnorr algortithm and its relevance in blockchain and more specifically in bitcoin.</p><h2 id="so-first-up-why-ec-schnorr">So first up why EC-schnorr?<a href="#so-first-up-why-ec-schnorr" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Whats the relevance of this algorithm in bitcoin? well all cryptocurrencies have a basic feature and that is transactions using acccount addresses. To verify that a certain transaction came from the correct account digital signatures are used i.e they validate a transaction. The private key is used to sign a certain message and the other nodes can apply the public key to get back the message from the signature and verify that with the attached message, if it doesnt verify that transaction is rejected and not registered on the ledger.</p><p>Currently bitcoin uses the ECDSA algorithm for achiving this. But now in the recent <em>Bitcoin Improvement Proposal <a href="https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki">BIP0340</a></em> EC-Schnorr algorithm has been proposed to replace the less efficient ECDSA system since its simpler and more faster.</p><h2 id="primer-on-ec-schnorr">Primer on EC-Schnorr<a href="#primer-on-ec-schnorr" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>It is an easy to understand algorithm and simple to implement and verify compared to its counterparts.</p><p>This like its predecessor, ECDSA operates over the secp256k1 curve paired with sha256 hashes for authentication.</p><p>Following is the signing /verification method as used in the algorithm</p><h3 id="signing">Signing<a href="#signing" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>\[m \qquad\quad\quad\; :Message \qquad\qquad\qquad\;\;\; (byte \; array)\] \[k \qquad\qquad\;\;\; :Private \; Key \quad\quad\quad\quad\quad (integer)\] \[G \qquad\qquad\;\; :Generator \; Point \quad\quad\;\;\;\;\; (curve point)\] \[P = k*G \quad :Public \; Key \quad\qquad\quad\;\;\;\;\;\;\; (curve point)\] \[z \quad\quad\qquad\;\;\;\; :Private \; nonce \qquad\qquad\; (integer)\] \[R = z*G \quad\; :Public \;nonce \qquad\qquad\;\;\; (curve point)\] \[e = Hash(r||P||m) \quad :aggregated hash \quad \; (integer)\]<p><br /></p><blockquote><p>$Here \; r,P,m \;\; are \; all \; represented \; in \; bytes$ $And \; r \; is \; the \; x \; cordinate \; of \; point \; R$</p></blockquote><p><br /></p>\[s = z + Hash(r||P||m)*k \quad :signature \quad (integer)\] \[(r, s) \qquad\quad\;\;\;\; :Signature \quad\qquad\qquad\;\; (integer, integer)\]<p><br /></p><h3 id="verification">Verification<a href="#verification" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><strong>Public Values</strong></p>\[(r, s) \qquad\quad\;\;\;\; :Signature\] \[P \quad\qquad\qquad\; :Public \; Key\] \[m \quad\qquad\qquad :Message\]<p><strong>Calculated Values</strong></p>\[R \quad\qquad :Public \; nonce \quad (calculated \; from \; r)\] \[e \quad\qquad\ :Hash(r||P||m)\]<p><strong>Verifying</strong></p>\[s = z + Hash(r||P||m)*k\] \[s*G = z*G + Hash(r||P||m)*k*G\] \[s*G =&gt; R + Hash(r||P||m)*P \tag{if true then verified}\]<p>Now that we know the basics of the signing/verification process we can move on the challenges…..</p><h2 id="challenges">Challenges<a href="#challenges" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li><strong><a href="https://vishvesh-rao.github.io/posts/SECURITY-OF-EC-SCHNORR-SIGNATURE-ALGORITHM/#ec-schnorr-nonce-reuse">EC-Schnorr Nonce Reuse</a></strong><li><strong><a href="https://vishvesh-rao.github.io/posts/SECURITY-OF-EC-SCHNORR-SIGNATURE-ALGORITHM/#linearly-related-nonces">Linearly Related Nonces</a></strong><li><strong><a href="https://vishvesh-rao.github.io/posts/SECURITY-OF-EC-SCHNORR-SIGNATURE-ALGORITHM/#multisignature-forgery">Multisignature Forgery</a></strong><li><strong><a href="https://vishvesh-rao.github.io/posts/SECURITY-OF-EC-SCHNORR-SIGNATURE-ALGORITHM/#wallet-key-reconstruction">Wallet Key Reconstruction</a></strong></ol><h2 id="ec-schnorr-nonce-reuse">EC-Schnorr Nonce Reuse<a href="#ec-schnorr-nonce-reuse" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="challenge">CHALLENGE<a href="#challenge" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>We are given the following values. Here the same private key has been used for signing two different messages, the aim is to extract the private key</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>You're given Schnorr signatures on two different messages signed by the same 
private key. Fortunately for you (the adversary), the signer screwed up their
implementation of BIP-340 and reused a nonce. Can you capitalize on this fatal 
error and extract the signer's private key?

Note: You may find it helpful to interpret some of the byte strings as ASCII,
in order to check your work.

Public Key: 463F9E1F3808CEDF5BB282427ECD1BFE8FC759BC6F65A42C90AA197EFC6F9F26
Message 1: 6368616E63656C6C6F72206F6E20746865206272696E6B206F66207365636F6E
Signature 1: F3F148DBF94B1BCAEE1896306141F319729DCCA9451617D4B529EB22C2FB521A32A1DB8D2669A00AFE7BE97AF8C355CCF2B49B9938B9E451A5C231A45993D920
Message 2: 6974206D69676874206D616B652073656E7365206A75737420746F2067657420
Signature 2: F3F148DBF94B1BCAEE1896306141F319729DCCA9451617D4B529EB22C2FB521A974240A9A9403996CA01A06A3BC8F0D7B71D87FB510E897FF3EC5BF347E5C5C1
</pre></table></code></div></div><h3 id="solution">SOLUTION<a href="#solution" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>so here the public key is given along with the two signatures for the two different messags</p><p><strong><em>known Values:</em></strong></p>\[n \quad\;\;\;\; :Curve \; Order\] \[G \quad\;\;\; :Generator \; for \; secp256k1 \; curve\] \[P \quad\;\;\; :Public \; Key\] \[m_1 \quad :Message \; 1\] \[m_2 \quad :Message \; 2\] \[(r,s_1) \quad :S_1 \; Signature \; of \; M_1\] \[(r,s_2) \quad :S_2 \; Signature \; of \; M_2\]<p><br /></p><blockquote><p>$\; r \; is \; the \; x \; cordinate \; of \; Public \; Nonce \; R$</p></blockquote><p><br /></p><p><strong><em>Calculated Values:</em></strong></p>\[R \quad\; :Public \; nonce \quad (calculated \; from \; r)\] \[e_1 \quad :Hash(r||P||m_1)\] \[e_2 \quad :Hash(r||P||m_2)\]<p><br /></p><p>Now that we have all the values we can write the equations for both $s_1$ and $s_2$</p>\[s_1 = z + Hash(r||P||m_1)*k \tag{1}\] \[s_2 = z + Hash(r||P||m_2)*k \tag{2}\]<p>Our aim is to get \(k\)</p><p>since the $z$ ( private nonce ) is same in both (1) and (2) we can do \(s_1 - s_2 \tag{3}\)</p><p>so we will get:</p>\[z + Hash(r||P||m_1)*k - (z + Hash(r||P||m_2)*k)\] \[z + Hash(r||P||m_1)*k - z - Hash(r||P||m_2)*k\] \[Hash(r||P||m_1)*k - Hash(r||P||m_2)*k\] \[e_1*k - e_2*k\]<p><br /></p><p>\((e_1-e_2)*k = s_1 - s_2 \tag{from 3}\) <br /></p>\[k = \frac{s_1 - s_2}{e_1-e_2}\]<p>Since all these operations are done in a finite field final equation will be</p>\[k \equiv (s_1 - s_2)*(e_1-e_2)^{-1} \bmod n \tag{4}\]<p>All the values in the RHS of (4) are known to us thus we can easily get the Private Key $k$</p><h3 id="implementation">IMPLEMENTATION<a href="#implementation" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="n">long_to_bytes</span><span class="p">,</span> <span class="n">bytes_to_long</span><span class="p">,</span> <span class="n">inverse</span>
<span class="kn">import</span> <span class="nn">hashlib</span>

<span class="n">n</span> <span class="o">=</span> <span class="mh">0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141</span>

<span class="n">p</span> <span class="o">=</span> <span class="s">"463F9E1F3808CEDF5BB282427ECD1BFE8FC759BC6F65A42C90AA197EFC6F9F26"</span>
<span class="n">m1</span> <span class="o">=</span> <span class="s">"6368616E63656C6C6F72206F6E20746865206272696E6B206F66207365636F6E"</span>
<span class="n">m2</span> <span class="o">=</span> <span class="s">"6974206D69676874206D616B652073656E7365206A75737420746F2067657420"</span>
<span class="n">s1</span> <span class="o">=</span> <span class="s">"F3F148DBF94B1BCAEE1896306141F319729DCCA9451617D4B529EB22C2FB521A32A1DB8D2669A00AFE7BE97AF8C355CCF2B49B9938B9E451A5C231A45993D920"</span>
<span class="n">s2</span> <span class="o">=</span> <span class="s">"F3F148DBF94B1BCAEE1896306141F319729DCCA9451617D4B529EB22C2FB521A974240A9A9403996CA01A06A3BC8F0D7B71D87FB510E897FF3EC5BF347E5C5C1"</span>

<span class="n">p</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="n">s1</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
<span class="n">s2</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>

<span class="n">r1</span><span class="p">,</span><span class="n">s1</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">32</span><span class="p">],</span><span class="n">s1</span><span class="p">[</span><span class="mi">32</span><span class="p">:]</span>
<span class="n">r2</span><span class="p">,</span><span class="n">s2</span> <span class="o">=</span> <span class="n">s2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">32</span><span class="p">],</span><span class="n">s2</span><span class="p">[</span><span class="mi">32</span><span class="p">:]</span>

<span class="n">r</span> <span class="o">=</span><span class="n">r1</span>

<span class="n">m1</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
<span class="n">m2</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>

<span class="n">s1</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">int_from_bytes</span><span class="p">(</span><span class="n">b</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="s">"big"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tagged_hash</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
    <span class="n">tag_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">tag</span><span class="p">.</span><span class="n">encode</span><span class="p">()).</span><span class="n">digest</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">tag_hash</span> <span class="o">+</span> <span class="n">tag_hash</span> <span class="o">+</span> <span class="n">msg</span><span class="p">).</span><span class="n">digest</span><span class="p">()</span>

<span class="n">e1</span> <span class="o">=</span> <span class="n">int_from_bytes</span><span class="p">(</span><span class="n">tagged_hash</span><span class="p">(</span><span class="s">"BIP0340/challenge"</span><span class="p">,</span> <span class="n">r</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="n">m1</span><span class="p">))</span> <span class="o">%</span> <span class="n">n</span>
<span class="n">e2</span> <span class="o">=</span> <span class="n">int_from_bytes</span><span class="p">(</span><span class="n">tagged_hash</span><span class="p">(</span><span class="s">"BIP0340/challenge"</span><span class="p">,</span> <span class="n">r</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="n">m2</span><span class="p">))</span> <span class="o">%</span> <span class="n">n</span>

<span class="n">secret_key</span> <span class="o">=</span> <span class="p">((</span><span class="n">s2</span><span class="o">-</span><span class="n">s1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">inverse</span><span class="p">(</span><span class="n">e2</span><span class="o">-</span><span class="n">e1</span><span class="p">,</span><span class="n">n</span><span class="p">)))</span><span class="o">%</span><span class="n">n</span>

<span class="k">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">secret_key</span><span class="p">))</span>

<span class="n">secret_key</span> <span class="o">=</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">secret_key</span><span class="p">)).</span><span class="n">hexdigest</span><span class="p">()</span>
</pre></table></code></div></div><blockquote><p>Here <code class="language-plaintext highlighter-rouge">s1</code> and <code class="language-plaintext highlighter-rouge">s2</code> represent the combined 64 byte signature $(r,s)$ of which 32 bytes are of $r$ and 32 bytes of $s$</p></blockquote><p>The secret key comes out to be <code class="language-plaintext highlighter-rouge">b'congratulations you found the sk'</code>.</p><h3 id="mitigation">MITIGATION<a href="#mitigation" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>So now that we have exploited the vulnerability how do we mitigate it well in this case its as simple as just using a different random private nonce commitment each time you sign a meassage.</p><h2 id="linearly-related-nonces">Linearly Related Nonces<a href="#linearly-related-nonces" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="challenge-1">CHALLENGE<a href="#challenge-1" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>The poor signer realized their mistake and upgraded their implementation to randomly generate (private) nonces. Unfortunately, they also didn’t get the memo to use a secure PRNG, and ended up using a Linear Congruential Generator instead.</p><p>You’re given Schnorr signatures on two different messages signed by the same private key. Although the signatures both verify under BIP-340, the two private nonces are related via $z2 = a * z1 + b$ , where $a = 31337$ and $b = 69420$.</p><p>Can you still extract the signer’s private key?</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>Public Key
21922E7D5988A711123794D70B19C2827B1630BC2AB99887418D9EF4AFDB1AC2

Message 1
49276D20626574746572207769746820636F6465207468616E20776974682077

Signature 1
19D6493FBA397CDD1C1E10F9AB51E65531D587D7C53C04673779E1A307AC795CF801B1BF3D103771F74C5F70BB3A3557D87E5116294A9ABD357DC4367D123C9D

Message 2
4265696E67206F70656E20736F75726365206D65616E7320616E796F6E652063

Signature 2
0293422DCE97000231B98AFE3CBE405601D4129296AB902822514DF9B2F0BC9D7FC2B9C64FA080688D020407900CE9DE887B9CBB25C34280DAB6E172CC39C2F0
</pre></table></code></div></div><h3 id="solution-1">SOLUTION<a href="#solution-1" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Here instead of reused nonce we are given a relation between the two nonces represented by $z_2 = 31337 * z_1 + 69420$</p><p>$z_1$ and $z_2$ are the private nonce value for the two 64 byte signatures $S_1$ and $S_2$</p><p>Since we already have an equaiton with the two nonces the obvious next step would be to get another equation in $z_1$ and $z_2$ and solving for both.</p><p>To do that lets look at the provided data:</p><p><strong><em>known Values:</em></strong></p>\[n \quad\;\;\;\; :Curve \; Order\] \[G \quad\;\;\; :Generator \; for \; secp256k1 \; curve\] \[P \quad\;\;\; :Public \; Key\] \[m_1 \quad :Message \; 1\] \[m_2 \quad :Message \; 2\] \[(r_1,s_1) \quad :S_1 \; Signature \; of \; M_1\] \[(r_2,s_2) \quad :S_2 \; Signature \; of \; M_2\]<blockquote><p>$\; r_1 \; and \; r_2 \; are \; the \; x \; cordinates \; of \; their \; corresponding \; Public \; Nonce \; values$</p></blockquote><p><strong><em>Calculated Values:</em></strong></p>\[e_1 \quad :Hash(r_1||P||m_1)\] \[e_2 \quad :Hash(r_2||P||m_2)\]<p>Now that we have all the values we can write the equations for both $s_1$ and $s_2$</p>\[s_1 = z_1 + Hash(r_1||P||m_1)*k \tag{1}\] \[s_2 = z_2 + Hash(r_2||P||m_2)*k \tag{2}\]<p>Our aim is to get an equation in $z_1$ and $z_2$ for that we wil need to eliminate $k$ from $(1)$ and $(2)$ <br /> \(Taking \;\; (1) :\) <br /></p>\[s_1 - z_1 = Hash(r_1||P||m_1)*k\] \[s_1 - z_1 = e_1*k\]<p>\(k \equiv (s_1 - z_1)*e_1^{-1} \bmod n \tag{3}\) <br /> \(Taking \;\; (2) :\) <br /></p>\[s_2 - z_2 = Hash(r_2||P||m_2)*k\] \[s_2 - z_2 = e_2*k\]<p>\(k \equiv (s_2 - z_2)*e_2^{-1} \bmod n \tag{4}\) <br /> \(From \;\; (3) \;\; and \;\; (4)\) <br /></p>\[(s_1 - z_1)*e_1^{-1} \equiv (s_2 - z_2)*e_2^{-1} \bmod n\] \[s_1*e_1^{-1} - z_1*e_1^{-1} \equiv s_2*e_2^{-1} - z_2*e_2^{-1} \bmod n\] \[z_2*e_2^{-1} - z_1*e_1^{-1} \equiv s_2*e_2^{-1} - s_1*e_1^{-1}\bmod n\]<p><br /></p><p>let \(s_2*e_2^{-1}-s_1*e_1^{-1}\) be $c$ so we get: \(z_2*e_2^{-1} - z_1*e_1^{-1} \equiv c\bmod\ n \tag{5}\)</p><p>\(z_2 - a * z_1 = b \tag{6}\) from $(5)$ and $(6)$ we can get the values of both nonces and then using either $(3)$ or $(4)$ we can get the private key $k$.</p><h3 id="mitigation-1">MITIGATION<a href="#mitigation-1" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><p>Again the answer here is simple read the definiton of nonce :). The word nonce itself is a combination of two words <strong><em>Only Once</em></strong>. Use a particular nonce only once in the whole algorithm implementation.</p><li><p>If you still dint understand here the definition from wikipedia <code class="language-plaintext highlighter-rouge">nonce (number once) is an arbitrary number that can be used just once in a cryptographic communication</code>.</p><li><p>Lastly, use a secure CSPRNG and dont go diving into implementing your own techniques for nonce generation.</p></ul><h2 id="multisignature-forgery">Multisignature Forgery<a href="#multisignature-forgery" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>This challenge was a bit on the harder side compared to the other two in the sense it required a bit more in dept knowledge of Elliptic Curves and EC-Schnorr signatures.</p><p>So before we actually dive into the challenge lets do a quick brief on multisignatures in EC-Schnorr.</p><h3 id="ec-schnorr-multisignatures">EC-Schnorr Multisignatures<a href="#ec-schnorr-multisignatures" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><p>Multisignature is used when a certain transaction is to be signed by more than one node. I.e before that transaction is broadcasted onto to the blockchain it is signed by multiple users.</p><li><p>In EC-Schnorr this <strong><em>multisig</em></strong> feature is achived via a property it has, namely <strong>Linearity</strong>. Schnorr signatures are Linear.</p><li><p>Simply meaning on adding two schnorr signatures the resultant is also a valid schnorr signature.</p><li><p>This property is very important as it enables multiple parties to share a common signature instead of generating multiple signaters over a message and sending it over a transaction.</p><li><p>The public keys of all signers are added and so are the public nonces R, and are translated into the public key and nonce commitment value for the aggregated multisig.</p></ul><p>Following are the steps to generate a two party multisignature: <br /></p><blockquote><p><strong>All the terms used are as explained in <a href="https://vishvesh-rao.github.io/posts/SECURITY-OF-EC-SCHNORR-SIGNATURE-ALGORITHM/#primer-on-ec-schnorr">this</a> section</strong></p></blockquote><p><br /></p><h4 id="additional-terms">ADDITIONAL TERMS:<a href="#additional-terms" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>\[P_{agg} \quad :Aggregate \;of \;public \;keys \;(P_1+P_2)\] \[z_{agg} \quad :Aggregate \;of \;private \;nonces \;(z_1+z_2)\] \[r_{agg} \quad :x \;cordinate \;of z_{agg}*G\]<h4 id="multi-sig--creation">MULTI SIG CREATION:<a href="#multi-sig--creation" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p><strong><em>Individual sig</em></strong></p>\[s_1 = z_1 + Hash(r_{agg}||P_{agg}||m)*k_1 \quad :sig \;of \;person 1\] \[s_1 = z_2 + Hash(r_{agg}||P_{agg}||m)*k_2 \quad :sig \;of \;person 2\]<p><strong><em>Aggregated sig</em></strong></p>\[s = s_1+s_2\] \[s = (z_1+z_2) + Hash(r_{agg}||P_{agg}||m)*(k_1+k_2)\]<p><br /></p>\[s = z_{agg} + Hash(r_{agg}||P_{agg}||m)*k \tag{aggregated signature}\]<h4 id="multi-sig-verification">MULTI SIG VERIFICATION:<a href="#multi-sig-verification" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>\[s*G = (z_1 + z_2)*G + Hash(r_{agg}||P_{agg}||m)*(k_1 + k_2)*G\] \[s*G = z_{agg}*G + Hash(r_{agg}||P_{agg}||m)*(P_1 + P_2)\]<p><br /></p>\[s*G = z_{agg}*G + Hash(r||P_{agg}||m)*P_{agg} \tag{if true then verified}\]<p><br /></p><p><strong><em>Now lets move on to the actul challenge…</em></strong></p><h3 id="challenge-2">CHALLENGE<a href="#challenge-2" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>This challenge is a server based nc challenge but for ease of solving the goal is just to write a function which will generate a forged function and pass the schnorr verification fucntion.</p><p><img data-src="https://codimd.s3.shivering-isles.com/demo/uploads/b701362d73f35ebdd3fa8d37f.png" alt="" data-proofer-ignore></p><p>You can download the files from <a href="https://gist.github.com/robot-dreams/6300fde4017eefcf02c241f203a75162">here</a></p><p>This is the function we have to implement:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">forge_signature</span><span class="p">(</span><span class="n">honest_signer</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
    <span class="s">"""
    TODO: Your implementation here!

    Your goal is to return a tuple with two elements:
        - A list of public keys, at least one of which is the
          honest signer's public key
        - A valid BIP-340 signature for the input msg, when verified
          against the aggregate public key which is the sum of the
          individual public keys in the above list

    In trying to generate a forgery, you may interact with the
    honest signer by calling public methods as much as you want;
    however, to make this attack realistic, you're NOT allowed to:
        - Access private fields of the honest signer
        
        - Ask the honest signer to generate a partial signature
          on the same (pubkeys, msg) pair as the forgery you
          output

    Hopefully these restrictions are obvious and sensible; otherwise
    the challenge would be trivial.

    Good luck!
    """</span>
</pre></table></code></div></div><h3 id="solution-2">SOLUTION<a href="#solution-2" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>So we have already seen how schnorr verification works for mutisignature now lets look at the custom implemetation of schnorr from <code class="language-plaintext highlighter-rouge">naive_multisig.py</code></p><p>Analysing the class <code class="language-plaintext highlighter-rouge">NaiveMultisigSigner</code></p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">NaiveMultisigSigner</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seckey</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">seckey</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">seckey</span> <span class="o">=</span> <span class="n">secrets</span><span class="p">.</span><span class="n">token_bytes</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">seckey</span> <span class="o">=</span> <span class="n">seckey</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">pubkey</span> <span class="o">=</span> <span class="n">pubkey_gen</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">seckey</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">seen_queries</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_pubkey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">pubkey</span>

    <span class="k">def</span> <span class="nf">gen_partial_pubnonce</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">secnonce</span> <span class="o">=</span> <span class="n">secrets</span><span class="p">.</span><span class="n">token_bytes</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pubkey_gen</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">secnonce</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gen_partial_sig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pubkeys</span><span class="p">,</span> <span class="n">aggnonce</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">pubkey_gen</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">seckey</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pubkeys</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">aggnonce</span><span class="p">)</span> <span class="o">==</span> <span class="mi">33</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">==</span> <span class="mi">32</span>

        <span class="n">X</span> <span class="o">=</span> <span class="n">xonly_point_agg</span><span class="p">(</span><span class="n">pubkeys</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">point_from_cbytes</span><span class="p">(</span><span class="n">aggnonce</span><span class="p">)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">xonly_int</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">secnonce</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">xonly_int</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">seckey</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
        <span class="n">agg_pubkey</span> <span class="o">=</span> <span class="n">bytes_from_point</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">int_from_bytes</span><span class="p">(</span><span class="n">tagged_hash</span><span class="p">(</span><span class="s">"BIP0340/c;hallenge"</span><span class="p">,</span> <span class="n">bytes_from_point</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="o">+</span> <span class="n">agg_pubkey</span> <span class="o">+</span> <span class="n">msg</span><span class="p">))</span> <span class="o">%</span> <span class="n">n</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">seen_queries</span><span class="p">.</span><span class="n">add</span><span class="p">((</span><span class="n">agg_pubkey</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">bytes_from_int</span><span class="p">((</span><span class="n">r1</span> <span class="o">+</span> <span class="n">e</span> <span class="o">*</span> <span class="n">x1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span>
</pre></table></code></div></div><p>So we can see that for each class object created it is assigned with a public Key and a public nonce commitment value which can be acessed by anyone.</p><p>The <code class="language-plaintext highlighter-rouge">gen_partial_sig</code> takes 3 arguements with pubkeys and nonce as lists and the msg in bytes. On line 28 the code: <code class="language-plaintext highlighter-rouge">self.seen_queries.add((agg_pubkey, msg))</code> this means an object can sign a particular message only once with its private key as its recorded.</p><p>Now looking at the <code class="language-plaintext highlighter-rouge">test_forgery()</code> function:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">test_forgery</span><span class="p">():</span>
    <span class="n">honest_signer</span> <span class="o">=</span> <span class="n">NaiveMultisigSigner</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'send all of Bob</span><span class="se">\'</span><span class="s">s coins to Alice'</span>

    <span class="n">pubkeys</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="n">forge_signature</span><span class="p">(</span><span class="n">honest_signer</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
    <span class="n">agg_pubkey</span> <span class="o">=</span> <span class="n">bytes_from_point</span><span class="p">(</span><span class="n">xonly_point_agg</span><span class="p">(</span><span class="n">pubkeys</span><span class="p">))</span>

    <span class="k">assert</span> <span class="n">honest_signer</span><span class="p">.</span><span class="n">get_pubkey</span><span class="p">()</span> <span class="ow">in</span> <span class="n">pubkeys</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">agg_pubkey</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">honest_signer</span><span class="p">.</span><span class="n">seen_queries</span>
    <span class="k">assert</span> <span class="n">schnorr_verify</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">agg_pubkey</span><span class="p">,</span> <span class="n">sig</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"sucess!!"</span><span class="p">)</span>
</pre></table></code></div></div><p>So from the first 2 assert functions we can get that the list of public keys should include the honest signers key and honest signer cannot sign the msg so inside the <code class="language-plaintext highlighter-rouge">forge_signature</code> we need to create another class object which will forge the signature acessing only the public parameters of honest signer.</p><p>TO achive this we need the verification service to think the aggregate public key and nonce of the multisignature came from only one signer.</p><p>This is achieved via the <code class="language-plaintext highlighter-rouge">Rogue Key Attack</code>. This is an attack vector that can be exploited in such implementations of schnorr multisignature where the an attacker who is part of the group creating the multisignature could claim a false Public Key, and control the Multi-Sig.</p><p>The following steps describe the attack:</p><ul><li><code class="language-plaintext highlighter-rouge">honest_signer</code> and <code class="language-plaintext highlighter-rouge">forged_signer</code> take part in a 2 party multisig.</ul><p>$(k_h,P_h)\quad :honest_signer \;key \;pair \;(PrivateKey,PublicKey)$ $(k_f,P_f)\quad :forged_signer \;key \;pair \;(PrivateKey,PublicKey)$</p><p>$P_{agg} \quad :Aggregate \;of \;public \;keys \;(P_h+P_f) $</p><p>$R_{agg} \quad :Aggregate \;of \;private \;nonces \;(R_h+R_f) $</p><p>$r_{agg} \quad\; :x \;cordinate \;of R_{agg}$</p><ul><li>Now <code class="language-plaintext highlighter-rouge">forged_signer</code> can send a false public key $P_{false}$ to add to the list such that resulting aggregate public key is <code class="language-plaintext highlighter-rouge">forged_signer</code> public key.</ul><p>$P_{false} = P_f - P_h$</p><ul><li><code class="language-plaintext highlighter-rouge">forged_signer</code> broadcasts $P_{false}$ as his public key:</ul><p>$P_{agg} = P_h + P_{false}$</p><p>$P_{agg} = P_h + (P_f - P_h)$</p><p>$P_{agg} = P_f$</p><ul><li>Since the aggregate key is now <code class="language-plaintext highlighter-rouge">forged_signer</code> true public key, <code class="language-plaintext highlighter-rouge">forged_signer</code> effectively controls the multi-sig.<li>The same procedure is done to generate the public nonce $R_{agg}$</ul><p>$R_{false} = R_f - R_h$</p><p>$P_{agg} = R_h + R_{false}$</p><p>$R_{agg} = R_h + (R_f - R_h)$</p><p>$R_{agg} = R_f$</p><ul><li>Now anyone any message signed with these parametrs is effictively signed only by <code class="language-plaintext highlighter-rouge">forged_signer</code>.</ul><h3 id="implementation-1">IMPLEMENTATION<a href="#implementation-1" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">forge_signature</span><span class="p">(</span><span class="n">honest_signer</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
   
    <span class="n">forged_signer</span> <span class="o">=</span> <span class="n">NaiveMultisigSigner</span><span class="p">()</span>
    <span class="n">X1</span> <span class="o">=</span> <span class="n">honest_signer</span><span class="p">.</span><span class="n">get_pubkey</span><span class="p">()</span>
    <span class="n">X2</span> <span class="o">=</span> <span class="n">forged_signer</span><span class="p">.</span><span class="n">get_pubkey</span><span class="p">()</span>

    <span class="n">X3</span> <span class="o">=</span> <span class="sa">b</span><span class="s">"NEG"</span><span class="o">+</span><span class="n">X1</span>

    <span class="kn">import</span> <span class="nn">code</span>
    <span class="n">code</span><span class="p">.</span><span class="n">interact</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="nb">locals</span><span class="p">())</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"exiting interactive mode!!"</span><span class="p">)</span>
    
    <span class="n">pubkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">X3</span><span class="p">]</span>
     
    <span class="c1">#print("agg key:",xonly_point_agg(pubkeys))
</span>    
    <span class="n">R1</span> <span class="o">=</span> <span class="n">honest_signer</span><span class="p">.</span><span class="n">gen_partial_pubnonce</span><span class="p">()</span>
    <span class="n">R2</span> <span class="o">=</span> <span class="n">forged_signer</span><span class="p">.</span><span class="n">gen_partial_pubnonce</span><span class="p">()</span>
    
    <span class="n">R3</span> <span class="o">=</span> <span class="sa">b</span><span class="s">"NEG"</span> <span class="o">+</span> <span class="n">R1</span> 
    
    <span class="n">R</span> <span class="o">=</span> <span class="n">xonly_point_agg</span><span class="p">([</span><span class="n">R1</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="n">R3</span><span class="p">])</span>
    <span class="c1"># print("agg nonce:",R)
</span>
    <span class="n">aggnonce</span> <span class="o">=</span> <span class="n">cbytes_from_point</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">forged_signer</span><span class="p">.</span><span class="n">gen_partial_sig</span><span class="p">(</span><span class="n">pubkeys</span><span class="p">,</span> <span class="n">aggnonce</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
      
    <span class="n">sig</span> <span class="o">=</span> <span class="n">bytes_from_point</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="o">+</span> <span class="n">sf</span>
   
    <span class="k">return</span> <span class="n">pubkeys</span><span class="p">,</span> <span class="n">sig</span>
</pre></table></code></div></div><blockquote><p>Here $X_3$ is the negetive of <code class="language-plaintext highlighter-rouge">honest_signer</code> public key $X_1$. On additionthe resultant will be $X_2$ which is <code class="language-plaintext highlighter-rouge">forged_signer</code> pub key.</p></blockquote><p>Since in ECC there is no negetive as all values are in a fine field negetive points on ECC are represented simply by taking the complement of the $y$ cordinates i.e if $(x,y)$ is a point on the curve its negetive $-(x,y)$ is simply $(x,p-y)$ where $p$ refers to the finite fields size.</p><h3 id="mitigation-2">MITIGATION<a href="#mitigation-2" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>So to avoid this attack we would need to verify each persons public key with a message signed by the private key, But this would require each member of the multi-sig to do this thereby nullifying the scaling and efficiency of schnorr multisig scheme.</p><p>To solve this a new scheme was developed called the <strong>Bellare-Neven</strong></p><h4 id="bellare-neven-scheme">Bellare-Neven Scheme<a href="#bellare-neven-scheme" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>in this scheme initially everyone shares their public key and a hash of the aggregated key is taken:</p><p><strong><em>signing</em></strong></p>\[\ell = Hash(P_{agg})\] \[a_i = Hash(\ell||P_i)\] \[P = \sum a_iP_i\] \[R_{agg} = \sum R_i\] \[e = Hash(R||P||m)\]<ul><li>Individual contribution to signature:</ul><p>$s_i = z_i + k_ia_ie$</p><ul><li>Final aggregated signature is as usual:</ul><p>$S = \sum s_i$</p><p><strong><em>verification</em></strong></p><p>$SG = R+eP$</p><ul><li>proof:</ul>\[SG = \sum s_i G\] \[= (z_i + k_ia_ie)G\] \[= \sum z_iG + e\sum k_ia_iG\] \[= \sum R_i + e\sum P_ia_i\] \[= R + eP\]<p>Now trying the key cancellation attack on this scheme we can proove that this is secure against such attacks…</p><ul><li>Taking 2 party eg with <code class="language-plaintext highlighter-rouge">honest_signer</code> and <code class="language-plaintext highlighter-rouge">forged_signer</code>…</ul><p>$P_{false} = P_f - P_h$</p><p>$R_{false} = R_f - R_h$</p><ul><li>This leads to both of them calculating the following “shared” values:</ul>\[\ell = Hash(P_h||P_{false})\] \[a_h = Hash(\ell||P_h)\] \[a_{false} = Hash(\ell||P_{false})\] \[P = a_{false}P_{false} + a_hP_h\] \[R = R_h + R_{false} = R_f\] \[e = Hash(R||P||m)\]<ul><li>forged sign is calculated as:</ul><p>$s_f = z_f + k_se$</p><ul><li>To get the correct mulsig</ul><p>$s_fG = R + eP$</p><ul><li>Proving it wrong:</ul>\[(z_f + k_se)G = R_f + e(a_{false}P_{false} + a_hP_h)\] \[R_f + k_seG = R_f + e(a_{false}P_f - a_{false}P_h + a_hP_h) \tag{$R_f$ is common}\] \[k_sGe = ea_{false}P_f - ea_{false}P_h + ea_hP_h \tag{$e$ is common}\]<p>\(k_sG = (a_{false}k_f - a_{false}k_h + a_hk_h)G \tag{$G$ is common}\) <br /></p>\[k_s = a_{false}k_f - a_{false}k_h + a_hk_h\]<p>hence we can see we do not have al the information to get the value on the RHS hence the forged signature cannot be calculated and attack is mitigated.</p><h2 id="wallet-key-reconstruction">Wallet Key Reconstruction<a href="#wallet-key-reconstruction" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="challenge-3">CHALLENGE<a href="#challenge-3" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><img data-src="https://codimd.s3.shivering-isles.com/demo/uploads/b701362d73f35ebdd3fa8d3de.png" alt="" data-proofer-ignore></p><p>Shares:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>(1, 0xB4EB3F62388EA2343FFC28BB342D4245E9C8B3B0602825235460DD74F0D47AB1)
(3, 0xBE3A9EC4C3D5FA291CAFBB54C5F0301F29FE14539575408B57F3CF6C0EA6399E)
(4, 0x760E31377BF2240AD9DA8A9843FF4B27A0D42F66DF029BF06A8F584FA008EA4D)
</pre></table></code></div></div><p>The code used to generate the shares is as follows:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">secrets</span>

<span class="c1"># Arbitrary upper bound
</span><span class="n">MAX_SHARES</span> <span class="o">=</span> <span class="mi">32</span>

<span class="c1"># Order of secp256k1 elliptic curve
</span><span class="n">p</span> <span class="o">=</span> <span class="mh">0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141</span>
<span class="n">R</span><span class="p">.</span><span class="o">&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">FiniteField</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">sss_get_shares</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="s">"""
    Splits the secret value D into n shares; k of n are needed
    to reconstruct the secret.

    D is a 256-bit integer in [0, p)
    """</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">D</span> <span class="o">&lt;</span> <span class="n">p</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">MAX_SHARES</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">D</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">a_i</span> <span class="o">=</span> <span class="n">secrets</span><span class="p">.</span><span class="n">randbelow</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
        <span class="n">q</span> <span class="o">+=</span> <span class="n">a_i</span> <span class="o">*</span> <span class="n">x</span><span class="o">^</span><span class="n">i</span>

    <span class="k">return</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">q</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</pre></table></code></div></div><h3 id="solution--implementation">SOLUTION / IMPLEMENTATION<a href="#solution--implementation" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>This was an easier challenge compared to the last one based on <a href="https://web.mit.edu/6.857/OldStuff/Fall03/ref/Shamir-HowToShareASecret.pdf">shamirs secret sharing scheme</a></p><p>Solve script:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">libnum</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">p</span> <span class="o">=</span> <span class="mh">0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141</span>

<span class="n">shares</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mh">0xB4EB3F62388EA2343FFC28BB342D4245E9C8B3B0602825235460DD74F0D47AB1</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span> <span class="mh">0xBE3A9EC4C3D5FA291CAFBB54C5F0301F29FE14539575408B57F3CF6C0EA6399E</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mh">0x760E31377BF2240AD9DA8A9843FF4B27A0D42F66DF029BF06A8F584FA008EA4D</span><span class="p">)</span> <span class="p">]</span>

<span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shares</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pair</span>
    <span class="n">top</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">bottom</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shares</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">xj</span><span class="p">,</span> <span class="n">yj</span> <span class="o">=</span> <span class="n">pair</span>
        <span class="n">top</span> <span class="o">=</span> <span class="p">(</span><span class="n">top</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">xj</span><span class="p">))</span> <span class="o">%</span> <span class="n">p</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="p">(</span><span class="n">bottom</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xj</span><span class="p">))</span> <span class="o">%</span> <span class="n">p</span>
    <span class="n">res</span> <span class="o">+=</span> <span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">top</span> <span class="o">*</span> <span class="n">invmod</span><span class="p">(</span><span class="n">bottom</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span> <span class="o">%</span> <span class="n">p</span>
    <span class="n">res</span> <span class="o">%=</span> <span class="n">p</span>

<span class="n">flag</span> <span class="o">=</span> <span class="n">n2s</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>

<span class="c1">#flag = correct! see you in the citadels
</span>
</pre></table></code></div></div><h2 id="conclusion">CONCLUSION<a href="#conclusion" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>I would really like to thank Elliot for making this amazing set of challenges while solving these I manged to learn a lot and all though there was some concepts I already knew I came across many new topics, some totally unrelated to the exploit for the challenges like the use of EC-schnorr in bitcoin, creating adresses in bitcoin, how to mitigate such attacks. Also came across a lot of papers and got to know about a lot more attacks/shortcomings of ECDSA/schnorr algorithms and how to correct them and their implementations in the bitcoin block chain.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/crypto/'>Crypto</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/bitcoin-protocols/" class="post-tag no-text-decoration" >Bitcoin protocols</a> <a href="/tags/schnorr/" class="post-tag no-text-decoration" >Schnorr</a> <a href="/tags/signaturealgirithm/" class="post-tag no-text-decoration" >Signaturealgirithm</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=SECURITY OF EC-SCHNORR SIGNATURE ALGORITHM - Stryd3r&url=https://vishvesh-rao.github.io/posts/SECURITY-OF-EC-SCHNORR-SIGNATURE-ALGORITHM/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=SECURITY OF EC-SCHNORR SIGNATURE ALGORITHM - Stryd3r&u=https://vishvesh-rao.github.io/posts/SECURITY-OF-EC-SCHNORR-SIGNATURE-ALGORITHM/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=SECURITY OF EC-SCHNORR SIGNATURE ALGORITHM - Stryd3r&url=https://vishvesh-rao.github.io/posts/SECURITY-OF-EC-SCHNORR-SIGNATURE-ALGORITHM/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/STABLEMAGNET-RUGPULL/">STABLEMAGNET SWAP - ANALYSIS OF A RUGPULL</a><li><a href="/posts/Ankr-aBNBc-Token-Exploit/">Ankr aBNBc Token Exploit</a><li><a href="/posts/How-Not-To-Use-Custom-Errors/">How Not To Use Custom Errors</a><li><a href="/posts/Ethernaut-CTF-Writeups-Part-1/">Ethernaut CTF Writeups - Part 1</a><li><a href="/posts/Ethernaut-CTF-Writeups-Part-2/">Ethernaut CTF Writeups - Part 2</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ethereum/">Ethereum</a> <a class="post-tag" href="/tags/solidity/">Solidity</a> <a class="post-tag" href="/tags/crypto/">Crypto</a> <a class="post-tag" href="/tags/rsa/">RSA</a> <a class="post-tag" href="/tags/abnbc/">aBNBc</a> <a class="post-tag" href="/tags/aes-ecb/">AES-ECB</a> <a class="post-tag" href="/tags/bitcoin-protocols/">Bitcoin protocols</a> <a class="post-tag" href="/tags/bsc/">BSC</a> <a class="post-tag" href="/tags/eqn-solving/">eqn solving</a> <a class="post-tag" href="/tags/fwordctf/">FwordCTF</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/STABLEMAGNET-RUGPULL/"><div class="card-body"> <em class="timeago small" date="2023-01-10 20:30:06 +0800" >Jan 10</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>STABLEMAGNET SWAP - ANALYSIS OF A RUGPULL</h3><div class="text-muted small"><p> Around $22.2 (currently 27 and increasing) BUSD was rug pulled from StableMagnet Swaps liquidity pool on 23rd June 2021. This is an analysis of the exploit…. Addresses Rug Pul...</p></div></div></a></div><div class="card"> <a href="/posts/Ankr-aBNBc-Token-Exploit/"><div class="card-body"> <em class="timeago small" date="2023-01-07 20:30:06 +0800" >Jan 7</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Ankr aBNBc Token Exploit</h3><div class="text-muted small"><p> Overview On 1st December 2022 Ankr’s BNB liquid staking token (aBNBc) was compromised and resulted in the hacker minting 60 trillion aBNBc which when compared to the liquidity res...</p></div></div></a></div><div class="card"> <a href="/posts/Bad-Proxies/"><div class="card-body"> <em class="timeago small" date="2022-11-06 20:30:06 +0800" >Nov 6, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Bad Proxies</h3><div class="text-muted small"><p> Motorbike Overview This challenge requires some pre requisites regarding upgradable smart contracts and differentmethods used to achieve this. This challenge is based on the uups...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Login-Fword_21/" class="btn btn-outline-primary" prompt="Older"><p>Login - Fword CTF 2021</p></a> <a href="/posts/Detailed-Postmortem-of-Uniswap-v2-Schnoodle-exploit/" class="btn btn-outline-primary" prompt="Newer"><p>Detailed Postmortem of Uniswap v2-Schnoodle Exploit</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://www.linkedin.com/in/vishvesh-rao-847368191">Vishvesh_R</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ethereum/">Ethereum</a> <a class="post-tag" href="/tags/solidity/">Solidity</a> <a class="post-tag" href="/tags/crypto/">Crypto</a> <a class="post-tag" href="/tags/rsa/">RSA</a> <a class="post-tag" href="/tags/abnbc/">aBNBc</a> <a class="post-tag" href="/tags/aes-ecb/">AES-ECB</a> <a class="post-tag" href="/tags/bitcoin-protocols/">Bitcoin protocols</a> <a class="post-tag" href="/tags/bsc/">BSC</a> <a class="post-tag" href="/tags/eqn-solving/">eqn solving</a> <a class="post-tag" href="/tags/fwordctf/">FwordCTF</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>

<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Ethernaut CTF Writeups - Part 1" /><meta name="author" content="Vishvesh" /><meta property="og:locale" content="en" /><meta name="description" content="A minimal, portfolio, sidebar, bootstrap Jekyll theme with responsive web design and focuses on text presentation." /><meta property="og:description" content="A minimal, portfolio, sidebar, bootstrap Jekyll theme with responsive web design and focuses on text presentation." /><link rel="canonical" href="https://vishvesh-rao.github.io/posts/Ethernaut-CTF-Writeups-Part-1/" /><meta property="og:url" content="https://vishvesh-rao.github.io/posts/Ethernaut-CTF-Writeups-Part-1/" /><meta property="og:site_name" content="Stryd3r" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-10-04T20:30:06+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Ethernaut CTF Writeups - Part 1" /><meta name="twitter:site" content="@The_Str1d3r" /><meta name="twitter:creator" content="@Vishvesh" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Vishvesh"},"description":"A minimal, portfolio, sidebar, bootstrap Jekyll theme with responsive web design and focuses on text presentation.","url":"https://vishvesh-rao.github.io/posts/Ethernaut-CTF-Writeups-Part-1/","@type":"BlogPosting","headline":"Ethernaut CTF Writeups - Part 1","dateModified":"2022-11-01T18:26:57+08:00","datePublished":"2022-10-04T20:30:06+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://vishvesh-rao.github.io/posts/Ethernaut-CTF-Writeups-Part-1/"},"@context":"https://schema.org"}</script><title>Ethernaut CTF Writeups - Part 1 | Stryd3r</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Stryd3r"><meta name="application-name" content="Stryd3r"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://codimd.s3.shivering-isles.com/demo/uploads/02a6da1fb9d19367162f423a3.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Stryd3r</a></div><div class="site-subtitle font-italic">~Vishvesh, 21.y.o ~Blockchain security ~@team bi0s</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-user-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/presentations/" class="nav-link"> <i class="fa-fw fas fa-play ml-xl-3 mr-xl-3 unloaded"></i> <span>TALKS/PRESENTATIONS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/resume/" class="nav-link"> <i class="fa-fw fas fa-folder fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>RESUME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/Vishvesh-rao" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/The_Str1d3r" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['vishveshsrao','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Ethernaut CTF Writeups - Part 1</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Ethernaut CTF Writeups - Part 1</h1><div class="post-meta text-muted"><div> By <em> <a href="https://www.linkedin.com/in/vishvesh-rao-847368191">Vishvesh_R</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-10-04 20:30:06 +0800" data-toggle="tooltip" data-placement="bottom" title="Tue, Oct 4, 2022, 8:30 PM +0800" >Oct 4, 2022</em> </span> <span> Updated <em class="timeago" date="2022-11-01 15:56:57 +0530 " data-toggle="tooltip" data-placement="bottom" title="Tue, Nov 1, 2022, 3:56 PM +0530" >Nov 1, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2594 words"> <em>14 min</em> read</span></div></div></div><div class="post-content"><html><head> <script type="text/javascript" async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"> </script> <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML"> MathJax.Hub.Config({ "HTML-CSS": { availableFonts: ["TeX"], }, tex2jax: { inlineMath: [['$','$'],["\\(","\\)"]]}, displayMath: [ ['$$','$$'], ['\[','\]'] ], TeX: { extensions: ["AMSmath.js", "AMSsymbols.js", "color.js"], equationNumbers: { autoNumber: "AMS" } }, showProcessingMessages: false, messageStyle: "none", imageFont: null, "AssistiveMML": { disabled: true } }); </script><hr /><p>I recently started attempting Ethernaut CTF challenges and it has been a great learning experience solving all these variety of challenges which cover a broad spectrum of topics in solidity security and best practices and some coding tricks, gas reduction techniques etc. Every challenge brings forward a new topic and lot of the levels are connected too making it more easier to connect different bugs and their solutions.</p><p>So this series of blog posts is just a way for me to document my findings for each challenge so that I can refer back to them if/when I forget in the future how I solved them or just want to look back at my methods at a later date.</p><p>So lets dive into itâ€¦..</p><hr /><h2 id="level-0-hello-world">Level 0 [Hello World]<a href="#level-0-hello-world" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>This is the introductory level where the entire level consistis of calling certain methods each pointing to another method name and at the end we need to authenticate with a password giving the password as a parameter to the <code class="language-plaintext highlighter-rouge">authenticate()</code> method. This level basically teaches us to use the console which is what we use to get the password which can be viewed through the password method. We get knowledge of the password method by viewing the list of contract objects via the console. The password comes out to be <em><code class="language-plaintext highlighter-rouge">"ethernaut0"</code></em></p><p>Below is the list of commands we need to enter into the console to complete the level:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">info</span><span class="p">()</span>

<span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">info1</span><span class="p">()</span>

<span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">info2</span><span class="p">()</span>

<span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">infonum</span><span class="p">()</span>

<span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">info42</span><span class="p">()</span>

<span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">theMethodname</span><span class="p">()</span>

<span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">method7123949</span><span class="p">()</span>

<span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">password</span><span class="p">()</span>

<span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">(</span><span class="dl">"</span><span class="s2">ethernaut0</span><span class="dl">"</span><span class="p">)</span>
</pre></table></code></div></div><hr /><h2 id="level-1-fallback">Level 1 [Fallback]<a href="#level-1-fallback" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>This level as the name describes familiarizes us with the <em>fallback</em> function in solidity</p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s">'@openzeppelin/contracts/math/SafeMath.sol'</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">Fallback</span> <span class="p">{</span>

  <span class="k">using</span> <span class="n">SafeMath</span> <span class="k">for</span> <span class="kt">uint256</span><span class="p">;</span>
  <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">public</span> <span class="n">contributions</span><span class="p">;</span>
  <span class="kt">address</span> <span class="k">payable</span> <span class="k">public</span> <span class="n">owner</span><span class="p">;</span>

  <span class="k">constructor</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
    <span class="n">contributions</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="kc">ether</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">modifier</span> <span class="n">onlyOwner</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="n">msg</span><span class="p">.</span><span class="n">sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">,</span>
            <span class="s">"caller is not the owner"</span>
        <span class="p">);</span>
        <span class="n">_</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="k">function</span> <span class="n">contribute</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mf">0.001</span> <span class="kc">ether</span><span class="p">);</span>
    <span class="n">contributions</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">+=</span> <span class="n">msg</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">contributions</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">contributions</span><span class="p">[</span><span class="n">owner</span><span class="p">])</span> <span class="p">{</span>
      <span class="n">owner</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">getContribution</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">contributions</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">withdraw</span><span class="p">()</span> <span class="k">public</span> <span class="n">onlyOwner</span> <span class="p">{</span>
    <span class="n">owner</span><span class="p">.</span><span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">contributions</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>As we can see there is a function called receive which when called sets the callers address as the owner of the contract. So our goal is to somehow make the contract execute this recieve function. Fallback functions in solidity are called when a contract gets called with ether passed along with the call and additionally some data may or may not be sent along. If the data field is not empty then the <em><code class="language-plaintext highlighter-rouge">fallback()</code></em> function is called else the <em><code class="language-plaintext highlighter-rouge">recive()</code></em> fucntion is called.</p><p>Thus we just send over a message call to the contract keeping the data field empty thus resulting in the execution of the recieve function and making us the owner of the contract. Therafter its straight forward to drain the contract of all the ether calling the <em><code class="language-plaintext highlighter-rouge">withdraw()</code></em> function.</p><p>Below is the code to execute the transaction calling the contract:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">contribute</span><span class="p">({</span><span class="na">value</span><span class="p">:</span><span class="nx">toWei</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)})</span>
</pre></table></code></div></div><hr /><h2 id="level-2-fallout">Level 2 [Fallout]<a href="#level-2-fallout" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>This level is an intro to what constructors are in a way. Constructors in solidity are functions which are called on contract intilization before the rest of the code is loaded. In solidity broadly there are two types of bytecodes the creation and runtime bytecode.</p><p>The constructor logic and its corresponding parameters etc get intialized in the creation bytecode that is generated on deployment of the smartcontract. It includes the input data to the transaction that creates the contract.</p><p>The creation bytecode intializes all the variables declared inside the constructor and sebsequently genrated the runtime code which includes the rest of the smart contract logic other than the constrctor.</p><p>This level highlights a classic flaw in the way constructors were allowed to be declared from solidity version <code class="language-plaintext highlighter-rouge">^0.6.0</code>. Constructors were basically named after the contract name itself like so:</p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">contract</span> <span class="n">example</span> <span class="p">{</span>
    <span class="k">function</span> <span class="n">example</span><span class="p">(){</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>now keeping this we will look at the challenge code:</p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s">'@openzeppelin/contracts/math/SafeMath.sol'</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">Fallout</span> <span class="p">{</span>
  
  <span class="k">using</span> <span class="n">SafeMath</span> <span class="k">for</span> <span class="kt">uint256</span><span class="p">;</span>
  <span class="k">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">allocations</span><span class="p">;</span>
  <span class="kt">address</span> <span class="k">payable</span> <span class="k">public</span> <span class="n">owner</span><span class="p">;</span>


  <span class="cm">/* constructor */</span>
  <span class="k">function</span> <span class="n">Fal1out</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
    <span class="n">allocations</span><span class="p">[</span><span class="n">owner</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">modifier</span> <span class="n">onlyOwner</span> <span class="p">{</span>
	        <span class="nb">require</span><span class="p">(</span>
	            <span class="n">msg</span><span class="p">.</span><span class="n">sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">,</span>
	            <span class="s">"caller is not the owner"</span>
	        <span class="p">);</span>
	        <span class="n">_</span><span class="p">;</span>
	    <span class="p">}</span>

  <span class="k">function</span> <span class="n">allocate</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
    <span class="n">allocations</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">allocations</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">].</span><span class="n">add</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">value</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">sendAllocation</span><span class="p">(</span><span class="kt">address</span> <span class="k">payable</span> <span class="n">allocator</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">allocations</span><span class="p">[</span><span class="n">allocator</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">allocator</span><span class="p">.</span><span class="nb">transfer</span><span class="p">(</span><span class="n">allocations</span><span class="p">[</span><span class="n">allocator</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">collectAllocations</span><span class="p">()</span> <span class="k">public</span> <span class="n">onlyOwner</span> <span class="p">{</span>
    <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">.</span><span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">allocatorBalance</span><span class="p">(</span><span class="kt">address</span> <span class="n">allocator</span><span class="p">)</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">allocations</span><span class="p">[</span><span class="n">allocator</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Here we can clearly see that the constructor is named improperly the contract name is Fallout while the constructor is named as Fal1out.</p><p>This will result in being not considered as a fucntion on compilation. rather this fucntion will be considered as anormal function and this means after deployment anybody could call this function which would not have been the case in the case of a constructor.</p><p>Thus we just need to call this method and as it sets the msg.sender as the owner we will be set as the owner of the function of the contract.</p><p>Below is the code:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">fal1out</span><span class="p">()</span>
</pre></table></code></div></div><hr /><h2 id="level-3-coin-flip">Level 3 [Coin Flip]<a href="#level-3-coin-flip" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>This challenge deals with the concept of randomness in blockchain. In blockchain since everything is deterministic there is no true source of randomness unless we bring some external oracle into the picture to provide a source of randomness.</p><p>In the challenge as we can see below its basically about guessing the value of a boolean variable correctly 10 times and on guessing wrong even once the the variable tracking the correct guesses is reset to 0.</p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s">'@openzeppelin/contracts/math/SafeMath.sol'</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">CoinFlip</span> <span class="p">{</span>

  <span class="k">using</span> <span class="n">SafeMath</span> <span class="k">for</span> <span class="kt">uint256</span><span class="p">;</span>
  <span class="kt">uint256</span> <span class="k">public</span> <span class="n">consecutiveWins</span><span class="p">;</span>
  <span class="kt">uint256</span> <span class="n">lastHash</span><span class="p">;</span>
  <span class="kt">uint256</span> <span class="n">FACTOR</span> <span class="o">=</span> <span class="mi">57896044618658097711785492504343953926634992332820282019728792003956564819968</span><span class="p">;</span>

  <span class="k">constructor</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
    <span class="n">consecutiveWins</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">flip</span><span class="p">(</span><span class="kt">bool</span> <span class="n">_guess</span><span class="p">)</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="n">blockValue</span> <span class="o">=</span> <span class="kt">uint256</span><span class="p">(</span><span class="nb">blockhash</span><span class="p">(</span><span class="n">block</span><span class="p">.</span><span class="n">number</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">1</span><span class="p">)));</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">lastHash</span> <span class="o">==</span> <span class="n">blockValue</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">revert</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">lastHash</span> <span class="o">=</span> <span class="n">blockValue</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="n">coinFlip</span> <span class="o">=</span> <span class="n">blockValue</span><span class="p">.</span><span class="n">div</span><span class="p">(</span><span class="n">FACTOR</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">side</span> <span class="o">=</span> <span class="n">coinFlip</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="nb">true</span> <span class="o">:</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">side</span> <span class="o">==</span> <span class="n">_guess</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">consecutiveWins</span><span class="o">++</span><span class="p">;</span>
      <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">consecutiveWins</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>As we can see on line 18 the randomness is generated from the hash of block number.</p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kt">uint256</span> <span class="n">blockValue</span> <span class="o">=</span> <span class="kt">uint256</span><span class="p">(</span><span class="nb">blockhash</span><span class="p">(</span><span class="n">block</span><span class="p">.</span><span class="n">number</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">1</span><span class="p">)));</span>
</pre></table></code></div></div><p>From line 26 we see that we need the value of the side variable to get a correct guess and side is calculated from blockValue which is derived from subtracting 1 from the current block number.</p><p>blockValue is further divided by FACTOR of which we know the value of and its result stores in coinFlip.</p><p>Hence what you migh notice here is that everything in this is already either known to us or can be easilt determined. This means we can just make the flip function ourself to correctly guess the value of side variable and submit it after calling the flip funcion doing these 2 calls 10 times will get us past the level.</p><hr /><h2 id="level-4-telephone">Level 4 [Telephone]<a href="#level-4-telephone" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>This level illustrates a classic phishing method that can be used to gain access of a smart contract that make use of such authenticating pattern.</p><p>The contract uses <code class="language-plaintext highlighter-rouge">tx.origin</code> check to assign the owner address, the problem is <code class="language-plaintext highlighter-rouge">tx.origin</code> is vulnerable to phishing attacks which can trick users into performing authenticated actions on the vulnerable contract.</p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">Telephone</span> <span class="p">{</span>

  <span class="kt">address</span> <span class="k">public</span> <span class="n">owner</span><span class="p">;</span>

  <span class="k">constructor</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">changeOwner</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tx</span><span class="p">.</span><span class="n">origin</span> <span class="o">!=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">owner</span> <span class="o">=</span> <span class="n">_owner</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The goal of this challenge is to pass the check on line 13 and become the owner. If we call the <em><code class="language-plaintext highlighter-rouge">changeOwner()</code></em> function directly with our player address then the <code class="language-plaintext highlighter-rouge">tx.origin</code> which is the address drom which the transaction originated (in this case our player address) and <code class="language-plaintext highlighter-rouge">msg.sender</code> (which will also be player address as we called the function) will be same and the check will fail.</p><p>To bypas this we make use of another contract say attack contract which will call the above contract call this the target contract. As calling another contract also is a message call hence when we call the attack contract the <code class="language-plaintext highlighter-rouge">tx.orgin</code> will be set to our address (player address) and this attack contract calls function in target contract making the <code class="language-plaintext highlighter-rouge">msg.sender</code> address as the attack contracts address as it is the one calling the <em><code class="language-plaintext highlighter-rouge">changeOwner()</code></em> function in target contract.</p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">interface</span> <span class="n">Telephone</span> <span class="p">{</span>
  <span class="k">function</span> <span class="n">changeOwner</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">contract</span> <span class="n">Attack</span> <span class="p">{</span>
    <span class="n">Telephone</span> <span class="n">telephone</span><span class="p">;</span>
    
    <span class="k">constructor</span><span class="p">(</span><span class="kt">address</span> <span class="n">telephoneInstance</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">telephone</span> <span class="o">=</span> <span class="n">Telephone</span><span class="p">(</span><span class="n">telephoneInstance</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">function</span> <span class="n">changeOwner</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">telephone</span><span class="p">.</span><span class="n">changeOwner</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><hr /><h2 id="level-5-token">Level 5 [Token]<a href="#level-5-token" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>This challenge is based on arithmetic overflow/underflow in solidity.</p><p>So lets understand what exactly this concept is first.</p><p>For all the data types present in Solidity the EVM has a specified size fixed for that particular data type. Meaning a certain data type can only represent values in certain range.</p><p>this concept becomes especiall intresting when it comes to integers as a basic uint8 can represent numbers from $0$ to $2^8-1$ i.e [0,255] this is the range of an 8 bit unsigned integer variable.</p><p>So integer overflow occurs when an unsigned integer variables value exceeds the range specified for that type and it cant hold that big a value anymore, in which case the value of that variable will be reset to its minimum value i.e 0 and if any excess is there then it will increase from 0 herafter i.e $255 + 1$ will result in $0$ while $255 + 2$ will result in $1$.</p><p>That was overflow in the case of integer underflow the same occurs just in reverse i.e subtracting 1 from 0 will result in 255 and so on, basically wrapping around but in reverse this time.</p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">Token</span> <span class="p">{</span>

  <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">balances</span><span class="p">;</span>
  <span class="kt">uint</span> <span class="k">public</span> <span class="n">totalSupply</span><span class="p">;</span>

  <span class="k">constructor</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_initialSupply</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">totalSupply</span> <span class="o">=</span> <span class="n">_initialSupply</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">)</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">-</span> <span class="n">_value</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_value</span><span class="p">;</span>
    <span class="n">balances</span><span class="p">[</span><span class="n">_to</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_value</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nb">balance</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">balances</span><span class="p">[</span><span class="n">_owner</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>As we can see we are provided with 20 tokens intially and to win we need to increase the number of tokens to a large value somehow.</p><p>The transfer function takes in 2 parameters, the amt to transfer and the adress to which to transfer it to. It checks if the sender has that amount to transfer at first then it subtracts that amount from the senders balance and adds it to the recivers balance.</p><p>The issue here is where it deducts the amount frm the senders balance:</p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_value</span><span class="p">;</span>
</pre></table></code></div></div><p>This line has the ability to underflow reason being there is no checks on the subtraction. Checks for overflow/underflow were not inherantly implemented until solidity version 0.8.0 and above.</p><p>Until then the developer had to make use of the safeMath library importing it explicitly and using it everytime an addition/subtraction needed to be performed and in this case looking at the solidity version we see that it is below 0.8.0 menaing it is vulnerable to underflow/overflows and since safeMath has not been called it is definetly going to cause underflows and overflows.</p><p>Taking advantage of this we can send to the transfer function some random address to which we want to transfer tokens and as value for the amount to transfer we can set it to 21.</p><p>This will result in the subtraction of 20 - 21 when the balance is being deducted from our account and this subsequently will result in an underflow and the value of our balance i.e the senders balance will be reset to the highest value that can be held by a uint variable which will result in a huge amount of tokens in our contract.</p><p>After this we simply need to submit our instance and we will have passed this level. ___</p><h2 id="level-6-delegation">Level 6 [Delegation]<a href="#level-6-delegation" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>This level illustrates the useage of delegate call method in solidity and why it should be used with the utmost precaution and how to exploit a delegate call not used properly.</p><p>Delegate call opcode executes the code in the called contract in the context of the calling contract i.e things like storage and msg.sender and msg.value remain unchanged.</p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">Delegate</span> <span class="p">{</span>

  <span class="kt">address</span> <span class="k">public</span> <span class="n">owner</span><span class="p">;</span>

  <span class="k">constructor</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">_owner</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">pwn</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">contract</span> <span class="n">Delegation</span> <span class="p">{</span>

  <span class="kt">address</span> <span class="k">public</span> <span class="n">owner</span><span class="p">;</span>
  <span class="n">Delegate</span> <span class="n">delegate</span><span class="p">;</span>

  <span class="k">constructor</span><span class="p">(</span><span class="kt">address</span> <span class="n">_delegateAddress</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="n">delegate</span> <span class="o">=</span> <span class="n">Delegate</span><span class="p">(</span><span class="n">_delegateAddress</span><span class="p">);</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">fallback</span><span class="p">()</span> <span class="k">external</span> <span class="p">{</span>
    <span class="p">(</span><span class="kt">bool</span> <span class="n">result</span><span class="p">,)</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">delegate</span><span class="p">).</span><span class="nb">delegatecall</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Storage in solidity can be understood as certain slots with each variable being assigned a slot starting from 0.</p><p>In <code class="language-plaintext highlighter-rouge">Delegation</code> contract in slot 0 the variable <code class="language-plaintext highlighter-rouge">owner</code> is stored in slot 0 and in <code class="language-plaintext highlighter-rouge">Delegate</code> contract too the variable <code class="language-plaintext highlighter-rouge">owner</code> is present in slot 0 and in <code class="language-plaintext highlighter-rouge">Delegate</code> contract we are modifying this <code class="language-plaintext highlighter-rouge">owner</code> variable inside <em><code class="language-plaintext highlighter-rouge">pwn()</code></em> function, this variable is present in slot 0 of <code class="language-plaintext highlighter-rouge">Delegate</code> contract, i.e the variable present in slot 0 of <code class="language-plaintext highlighter-rouge">Delegation</code> contract will be modified on calling <em><code class="language-plaintext highlighter-rouge">pwn()</code></em> function as the call is a delegate call which modifies the corresponding storage slot in the calling contract.</p><p>Thus if we call via delegate call the <em><code class="language-plaintext highlighter-rouge">pwn()</code></em> function in Delegate contract with player address our address will be set as the owner of the Delegation contract and thereby we can pass the challenge.</p><p>To call <em><code class="language-plaintext highlighter-rouge">pwn()</code></em> function we need to encode the functionâ€™s signature in the <code class="language-plaintext highlighter-rouge">msg.data</code> field. In solidity encoded function signature of any function is the starting 4 bytes of the $keccak256$ hash of the functions signature. Function signature comprises of the function name along with the data type of parameters seperated by commas and enclosed in paranthesis.</p><p>The following code can be input into the console to pass the challenge:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">await</span> <span class="nx">sendTransaction</span><span class="p">({</span><span class="na">from</span><span class="p">:</span> <span class="nx">player</span><span class="p">,</span> <span class="na">to</span><span class="p">:</span> <span class="nx">instance</span><span class="p">,</span> <span class="na">data</span><span class="p">:</span> <span class="dl">"</span><span class="s2">0xdd365b8b</span><span class="dl">"</span><span class="p">})</span>
</pre></table></code></div></div><hr /><p>Refer the next part for further solutions</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blockchain/'>Blockchain</a>, <a href='/categories/ctf-writeups/'>CTF-Writeups</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ethereum/" class="post-tag no-text-decoration" >Ethereum</a> <a href="/tags/solidity/" class="post-tag no-text-decoration" >Solidity</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Ethernaut CTF Writeups - Part 1 - Stryd3r&url=https://vishvesh-rao.github.io/posts/Ethernaut-CTF-Writeups-Part-1/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Ethernaut CTF Writeups - Part 1 - Stryd3r&u=https://vishvesh-rao.github.io/posts/Ethernaut-CTF-Writeups-Part-1/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Ethernaut CTF Writeups - Part 1 - Stryd3r&url=https://vishvesh-rao.github.io/posts/Ethernaut-CTF-Writeups-Part-1/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/STABLEMAGNET-RUGPULL/">STABLEMAGNET SWAP - ANALYSIS OF A RUGPULL</a><li><a href="/posts/Ankr-aBNBc-Token-Exploit/">Ankr aBNBc Token Exploit</a><li><a href="/posts/How-Not-To-Use-Custom-Errors/">How Not To Use Custom Errors</a><li><a href="/posts/Ethernaut-CTF-Writeups-Part-1/">Ethernaut CTF Writeups - Part 1</a><li><a href="/posts/Ethernaut-CTF-Writeups-Part-2/">Ethernaut CTF Writeups - Part 2</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ethereum/">Ethereum</a> <a class="post-tag" href="/tags/solidity/">Solidity</a> <a class="post-tag" href="/tags/crypto/">Crypto</a> <a class="post-tag" href="/tags/rsa/">RSA</a> <a class="post-tag" href="/tags/abnbc/">aBNBc</a> <a class="post-tag" href="/tags/aes-ecb/">AES-ECB</a> <a class="post-tag" href="/tags/bitcoin-protocols/">Bitcoin protocols</a> <a class="post-tag" href="/tags/bsc/">BSC</a> <a class="post-tag" href="/tags/eqn-solving/">eqn solving</a> <a class="post-tag" href="/tags/fwordctf/">FwordCTF</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Ethernaut-CTF-Writeups-Part-2/"><div class="card-body"> <em class="timeago small" date="2022-10-04 20:30:06 +0800" >Oct 4, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Ethernaut CTF Writeups - Part 2</h3><div class="text-muted small"><p> Continuing from where we left ofâ€¦â€¦ ___ Level 7 [Force] This challenge appraises on a certain unconventional way of sending ether to a contract. To send ether as we normally do vi...</p></div></div></a></div><div class="card"> <a href="/posts/How-Not-To-Use-Custom-Errors/"><div class="card-body"> <em class="timeago small" date="2022-11-06 20:30:06 +0800" >Nov 6, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How Not To Use Custom Errors</h3><div class="text-muted small"><p> Good Samaritan Overview This challenge focuses on a relatively new feature introduced recently in solidity known as custom errors used for better error handling. The challenge is ...</p></div></div></a></div><div class="card"> <a href="/posts/Bad-Proxies/"><div class="card-body"> <em class="timeago small" date="2022-11-06 20:30:06 +0800" >Nov 6, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Bad Proxies</h3><div class="text-muted small"><p> Motorbike Overview This challenge requires some pre requisites regarding upgradable smart contracts and differentmethods used to achieve this. This challenge is based on the uups...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Detailed-Postmortem-of-Uniswap-v2-Schnoodle-exploit/" class="btn btn-outline-primary" prompt="Older"><p>Detailed Postmortem of Uniswap v2-Schnoodle Exploit</p></a> <a href="/posts/Ethernaut-CTF-Writeups-Part-2/" class="btn btn-outline-primary" prompt="Newer"><p>Ethernaut CTF Writeups - Part 2</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> Â© 2023 <a href="https://www.linkedin.com/in/vishvesh-rao-847368191">Vishvesh_R</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ethereum/">Ethereum</a> <a class="post-tag" href="/tags/solidity/">Solidity</a> <a class="post-tag" href="/tags/crypto/">Crypto</a> <a class="post-tag" href="/tags/rsa/">RSA</a> <a class="post-tag" href="/tags/abnbc/">aBNBc</a> <a class="post-tag" href="/tags/aes-ecb/">AES-ECB</a> <a class="post-tag" href="/tags/bitcoin-protocols/">Bitcoin protocols</a> <a class="post-tag" href="/tags/bsc/">BSC</a> <a class="post-tag" href="/tags/eqn-solving/">eqn solving</a> <a class="post-tag" href="/tags/fwordctf/">FwordCTF</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG â€º <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>

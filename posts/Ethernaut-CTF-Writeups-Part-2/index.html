<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Ethernaut CTF Writeups - Part 2" /><meta name="author" content="Vishvesh" /><meta property="og:locale" content="en" /><meta name="description" content="A minimal, portfolio, sidebar, bootstrap Jekyll theme with responsive web design and focuses on text presentation." /><meta property="og:description" content="A minimal, portfolio, sidebar, bootstrap Jekyll theme with responsive web design and focuses on text presentation." /><link rel="canonical" href="https://vishvesh-rao.github.io/posts/Ethernaut-CTF-Writeups-Part-2/" /><meta property="og:url" content="https://vishvesh-rao.github.io/posts/Ethernaut-CTF-Writeups-Part-2/" /><meta property="og:site_name" content="Stryd3r" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-10-04T20:30:06+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Ethernaut CTF Writeups - Part 2" /><meta name="twitter:site" content="@The_Str1d3r" /><meta name="twitter:creator" content="@Vishvesh" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Vishvesh"},"description":"A minimal, portfolio, sidebar, bootstrap Jekyll theme with responsive web design and focuses on text presentation.","url":"https://vishvesh-rao.github.io/posts/Ethernaut-CTF-Writeups-Part-2/","@type":"BlogPosting","headline":"Ethernaut CTF Writeups - Part 2","dateModified":"2022-10-11T02:24:52+08:00","datePublished":"2022-10-04T20:30:06+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://vishvesh-rao.github.io/posts/Ethernaut-CTF-Writeups-Part-2/"},"@context":"https://schema.org"}</script><title>Ethernaut CTF Writeups - Part 2 | Stryd3r</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Stryd3r"><meta name="application-name" content="Stryd3r"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://codimd.s3.shivering-isles.com/demo/uploads/02a6da1fb9d19367162f423a3.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Stryd3r</a></div><div class="site-subtitle font-italic">~Vishvesh, 21.y.o ~Blockchain security ~@team bi0s</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-user-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/presentations/" class="nav-link"> <i class="fa-fw fas fa-play ml-xl-3 mr-xl-3 unloaded"></i> <span>TALKS/PRESENTATIONS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/resume/" class="nav-link"> <i class="fa-fw fas fa-folder fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>RESUME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/Vishvesh-rao" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/The_Str1d3r" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['vishveshsrao','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Ethernaut CTF Writeups - Part 2</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Ethernaut CTF Writeups - Part 2</h1><div class="post-meta text-muted"><div> By <em> <a href="https://www.linkedin.com/in/vishvesh-rao-847368191">Vishvesh_R</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-10-04 20:30:06 +0800" data-toggle="tooltip" data-placement="bottom" title="Tue, Oct 4, 2022, 8:30 PM +0800" >Oct 4, 2022</em> </span> <span> Updated <em class="timeago" date="2022-10-10 23:54:52 +0530 " data-toggle="tooltip" data-placement="bottom" title="Mon, Oct 10, 2022, 11:54 PM +0530" >Oct 10, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2559 words"> <em>14 min</em> read</span></div></div></div><div class="post-content"><html><head> <script type="text/javascript" async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"> </script> <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML"> MathJax.Hub.Config({ "HTML-CSS": { availableFonts: ["TeX"], }, tex2jax: { inlineMath: [['$','$'],["\\(","\\)"]]}, displayMath: [ ['$$','$$'], ['\[','\]'] ], TeX: { extensions: ["AMSmath.js", "AMSsymbols.js", "color.js"], equationNumbers: { autoNumber: "AMS" } }, showProcessingMessages: false, messageStyle: "none", imageFont: null, "AssistiveMML": { disabled: true } }); </script><hr /><p>Continuing from where we left of…… ___</p><h2 id="level-7-force">Level 7 [Force]<a href="#level-7-force" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>This challenge appraises on a certain unconventional way of sending ether to a contract.</p><p>To send ether as we normally do via <em><code class="language-plaintext highlighter-rouge">transfer()</code></em>, <em><code class="language-plaintext highlighter-rouge">send()</code></em> or <em><code class="language-plaintext highlighter-rouge">call()</code></em> to any contract we need it to be able to receive it via a function declared as payable.</p><p>But what if such a function is not present or in general are there any other ways to send ether to contracts otherthan the once mentioned above?… Turns out there are certain unconventional methods we can use to send ether to contracts or for that matter any valid ethereum address even if that address is not yet created or in use.</p><p>There are currently 3 ways to send ether to contracts/addreses even if they have no feature to receive ether:</p><ul><li><p><strong>Via block rewards:</strong> If miner earns ether via sucessfull proof of work then the miner would receive a block reward and the miner can specify to which address this reward should be sent.</p><li><p><strong>Sending to a Pre-calculated address:</strong> As in the ethereum ecosystem calculating address is a deterministic process it is possible to easily calculate the address that would be assigned to a contract even before it is deployed thus if ether is send to that account beforehand than itwill have a non zro amount of eher on contract creation.</p><li><p><strong>Self Destruct:</strong> This is the most common one and includes calling the sucide opcode which will result in self destruct of entire contract code and its storageand all ether present in the contract will be sent to the specified address in the <em><code class="language-plaintext highlighter-rouge">selfdestruct()</code></em> function.</p></ul><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">Force</span> <span class="p">{</span><span class="cm">/*

                   MEOW ?
         /\_/\   /
    ____/ o o \
  /~____  =ø= /
 (______)__m_m)

*/</span><span class="p">}</span>
</pre></table></code></div></div><p>As we can see the easiest way is to send ether to this contract via <em><code class="language-plaintext highlighter-rouge">selfdestruc()</code></em>.</p><p>All we need is a contract to which we need to send some ether and then call <code class="language-plaintext highlighter-rouge">selfdestruct(target_address)</code></p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">Exploit</span><span class="p">{</span>
    <span class="k">constructor</span> <span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="nb">selfdestruct</span><span class="p">(</span><span class="n">instanceAddress</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><hr /><h2 id="level-8-vault">Level 8 [Vault]<a href="#level-8-vault" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>This challenge enlightens us to a fundamental property of blockchain in general that is everything is publicly available unlike a normal codebase.</p><p>Everything from contract code timstamps to contracts storage is visible to everyone in the blockchain system. Hence care should be taken to never disclose sensitive information in smart contracts.</p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">Vault</span> <span class="p">{</span>
  <span class="kt">bool</span> <span class="k">public</span> <span class="n">locked</span><span class="p">;</span>
  <span class="kt">bytes32</span> <span class="k">private</span> <span class="n">password</span><span class="p">;</span>

  <span class="k">constructor</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">_password</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="n">locked</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">_password</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">unlock</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">_password</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">password</span> <span class="o">==</span> <span class="n">_password</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">locked</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>So as we can see in the contract to pass this level we need to set the locked variable to false. It can be done by calling the unlock function but there is a check inside it to see if we provided the correct pasword only then will it set locked to false.</p><p>If we look at the declaration of password we notice it is set to private but then again this is all in the block chain and just because a variable is set to private doesent mean we cant read its value.</p><p>Private keyword only makes the variable safe from inheritance from other contracts and external contracts cant read the variable also unlike public variable which get a public getter function private variables dont have this.</p><p>But after all this when it comes to accessing the storage manually via a block explorer there is no difference in if the variable is public or private since all variables storage can be accessed easily.</p><p>So all we need to do is read the sorage slot where this variable is stored which in this case is slot 1.</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">password</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getStorageAt</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></table></code></div></div><hr /><h2 id="level-9-king">Level 9 [King]<a href="#level-9-king" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>This challenge brings to light the pull over push pattern thats should be followed whenever ether needs to be transferred. It aims at shifting the risk associated with transferring ether to the user.</p><p>Sending ether to another address in Ethereum involves a call to the receiving entity. There are several reasons why this external call could fail. If the receiving address is a contract, it could have a fallback function implemented that simply throws an exception, once it gets called. Another reason for failure is running out of gas. Thus its always better to have the user call a withdraw() function rather than the contract transferring it itself.</p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">King</span> <span class="p">{</span>

  <span class="kt">address</span> <span class="k">payable</span> <span class="n">king</span><span class="p">;</span>
  <span class="kt">uint</span> <span class="k">public</span> <span class="n">prize</span><span class="p">;</span>
  <span class="kt">address</span> <span class="k">payable</span> <span class="k">public</span> <span class="n">owner</span><span class="p">;</span>

  <span class="k">constructor</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>  
    <span class="n">king</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
    <span class="n">prize</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="n">prize</span> <span class="o">||</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">);</span>
    <span class="n">king</span><span class="p">.</span><span class="nb">transfer</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">value</span><span class="p">);</span>
    <span class="n">king</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
    <span class="n">prize</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">_king</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="k">payable</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">king</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>In this contract our goal is to block the contract from making anyone else king even if they send more ether than the current kings ether which is the check defined in the contract.</p><p>To this we need to just make sure the contract is never able to execute line 19 in whcih it assigns the new king. Also we notice that the contract is not following the pull over push pattern thus we can easily stop code execution when the contract transfers ether to a contract we specify.</p><p>All we need to do is declare a fallback fucntion in our contract which reverts eeverytime the contract reveives ether thus blocking the contracts code execution.</p><hr /><h2 id="level-11-elevator">Level 11 [Elevator]<a href="#level-11-elevator" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>This is just a starightforward challenge and more about just writing the correct contract code so that it passes the checks.</p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">interface</span> <span class="n">Building</span> <span class="p">{</span>
  <span class="k">function</span> <span class="n">isLastFloor</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">contract</span> <span class="n">Elevator</span> <span class="p">{</span>
  <span class="kt">bool</span> <span class="k">public</span> <span class="n">top</span><span class="p">;</span>
  <span class="kt">uint</span> <span class="k">public</span> <span class="n">floor</span><span class="p">;</span>

  <span class="k">function</span> <span class="n">goTo</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_floor</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="n">Building</span> <span class="n">building</span> <span class="o">=</span> <span class="n">Building</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="n">building</span><span class="p">.</span><span class="n">isLastFloor</span><span class="p">(</span><span class="n">_floor</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">floor</span> <span class="o">=</span> <span class="n">_floor</span><span class="p">;</span>
      <span class="n">top</span> <span class="o">=</span> <span class="n">building</span><span class="p">.</span><span class="n">isLastFloor</span><span class="p">(</span><span class="n">floor</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>So here the goal is to make the top variable to true. As we see the <em><code class="language-plaintext highlighter-rouge">goto()</code></em> fucntion is calling an external contract which implements a method called <em><code class="language-plaintext highlighter-rouge">isLastFloor()</code></em> and it takes one parameter. On the first call to <em><code class="language-plaintext highlighter-rouge">isLastfloor()</code></em> it should return false to pass the check with the parameter <code class="language-plaintext highlighter-rouge">_floor</code> and once the check is cleared the same function should return true on calling it for a second time with the same parameter.</p><p>The following is the code of the Building contract which achieves that:</p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">interface</span> <span class="n">Elevator</span> <span class="p">{</span>
    <span class="k">function</span> <span class="n">goTo</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_floor</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">contract</span> <span class="n">Building</span> <span class="p">{</span>
    <span class="kt">bool</span> <span class="k">private</span> <span class="n">check</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    
    <span class="k">function</span> <span class="n">isLastFloor</span><span class="p">(</span><span class="kt">uint</span> <span class="n">floor</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">check</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">function</span> <span class="n">start</span><span class="p">(</span><span class="kt">address</span> <span class="n">elevatorInstance</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">Elevator</span> <span class="n">elevator</span> <span class="o">=</span> <span class="n">Elevator</span><span class="p">(</span><span class="n">elevatorInstance</span><span class="p">);</span>
        <span class="n">elevator</span><span class="p">.</span><span class="n">goTo</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><hr /><h2 id="level-12-privacy">Level 12 [Privacy]<a href="#level-12-privacy" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>This challenge familiarizes us with storage methods in solidity and how packing is done by the compiler to optimize storage space.</p><p>Each storage slot in solidity is of 32 bytes and storage occurs in a sequential way where the slot starts from 0 and variables can be grouped together if enough space is still available in a particular slot this is known as packing. Packing can be done only in case of statically-sized variable i.e complex types like mapping and dynamic sized arrays are always stored begining from a new slot and cannot be packed.</p><p>Below is the challenge contract:</p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">Privacy</span> <span class="p">{</span>

  <span class="kt">bool</span> <span class="k">public</span> <span class="n">locked</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="kt">uint256</span> <span class="k">public</span> <span class="n">ID</span> <span class="o">=</span> <span class="n">block</span><span class="p">.</span><span class="n">timestamp</span><span class="p">;</span>
  <span class="kt">uint8</span> <span class="k">private</span> <span class="n">flattening</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="kt">uint8</span> <span class="k">private</span> <span class="n">denomination</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
  <span class="kt">uint16</span> <span class="k">private</span> <span class="n">awkwardness</span> <span class="o">=</span> <span class="kt">uint16</span><span class="p">(</span><span class="nb">now</span><span class="p">);</span>
  <span class="kt">bytes32</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">private</span> <span class="n">data</span><span class="p">;</span>

  <span class="k">constructor</span><span class="p">(</span><span class="kt">bytes32</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">memory</span> <span class="n">_data</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">_data</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">function</span> <span class="n">unlock</span><span class="p">(</span><span class="kt">bytes16</span> <span class="n">_key</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">_key</span> <span class="o">==</span> <span class="kt">bytes16</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span>
    <span class="n">locked</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/*
    A bunch of super advanced solidity algorithms...

      ,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`
      .,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,
      *.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^         ,---/V\
      `*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.    ~|__(o.o)
      ^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'  UU  UU
  */</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Now lets analyze the storage structure of the given contract.</p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>  <span class="kt">bool</span> <span class="k">public</span> <span class="n">locked</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> <span class="c1">// stored in slot 0 [1 byte]
</span>
  <span class="kt">uint256</span> <span class="k">public</span> <span class="n">ID</span> <span class="o">=</span> <span class="n">block</span><span class="p">.</span><span class="n">timestamp</span><span class="p">;</span> <span class="c1">// stored in slot 1 (complex type) [32 bytes]
</span>
  <span class="kt">uint8</span> <span class="k">private</span> <span class="n">flattening</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// stored in slot 2 [1 byte]
</span>
  <span class="kt">uint8</span> <span class="k">private</span> <span class="n">denomination</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span> <span class="c1">// stored in slot 2 [1 byte] goes into slot 2 due to packing
</span>
  <span class="kt">uint16</span> <span class="k">private</span> <span class="n">awkwardness</span> <span class="o">=</span> <span class="kt">uint16</span><span class="p">(</span><span class="nb">now</span><span class="p">);</span> <span class="c1">// stored in slot 2 [2 bytes] goes into slot 2 due to packing
</span>
  <span class="kt">bytes32</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">private</span> <span class="n">data</span><span class="p">;</span> <span class="c1">// occupies slots 3,4,5 and 6 (complex type) [4x32 bytes] as complex type it starts from a new slot
</span></pre></table></code></div></div><p>Now on line 17 we can see that function <em><code class="language-plaintext highlighter-rouge">unlock()</code></em> takes in a key as a parameter and that key is checked with the first 16 bytes of the value stored in the 3rd storage variable of the <code class="language-plaintext highlighter-rouge">data</code> array.</p><p>Looking at the analysis of the storage pattern of this contract we see that <code class="language-plaintext highlighter-rouge">data[2]</code> will be stored in the 5th slot so all we need to do is read that memory slot and take the first 16 bytes and pass it to the <em><code class="language-plaintext highlighter-rouge">unlock()</code></em> function to pass this level.</p><hr /><h2 id="level-13-gatekeeper-one">Level 13 [Gatekeeper One]<a href="#level-13-gatekeeper-one" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>As the name suggests this challenges consists of 3 gates which we need to pass in order to solve it. Each gate is a require statement enclosed in a modifier.</p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s">'@openzeppelin/contracts/math/SafeMath.sol'</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">GatekeeperOne</span> <span class="p">{</span>

  <span class="k">using</span> <span class="n">SafeMath</span> <span class="k">for</span> <span class="kt">uint256</span><span class="p">;</span>
  <span class="kt">address</span> <span class="k">public</span> <span class="n">entrant</span><span class="p">;</span>

  <span class="k">modifier</span> <span class="n">gateOne</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span> <span class="o">!=</span> <span class="n">tx</span><span class="p">.</span><span class="n">origin</span><span class="p">);</span>
    <span class="n">_</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">modifier</span> <span class="n">gateTwo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="nb">gasleft</span><span class="p">().</span><span class="n">mod</span><span class="p">(</span><span class="mi">8191</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">_</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">modifier</span> <span class="n">gateThree</span><span class="p">(</span><span class="kt">bytes8</span> <span class="n">_gateKey</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">require</span><span class="p">(</span><span class="kt">uint32</span><span class="p">(</span><span class="kt">uint64</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">))</span> <span class="o">==</span> <span class="kt">uint16</span><span class="p">(</span><span class="kt">uint64</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">)),</span> <span class="s">"GatekeeperOne: invalid gateThree part one"</span><span class="p">);</span>
      <span class="nb">require</span><span class="p">(</span><span class="kt">uint32</span><span class="p">(</span><span class="kt">uint64</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">))</span> <span class="o">!=</span> <span class="kt">uint64</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">),</span> <span class="s">"GatekeeperOne: invalid gateThree part two"</span><span class="p">);</span>
      <span class="nb">require</span><span class="p">(</span><span class="kt">uint32</span><span class="p">(</span><span class="kt">uint64</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">))</span> <span class="o">==</span> <span class="kt">uint16</span><span class="p">(</span><span class="n">tx</span><span class="p">.</span><span class="n">origin</span><span class="p">),</span> <span class="s">"GatekeeperOne: invalid gateThree part three"</span><span class="p">);</span>
    <span class="n">_</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">enter</span><span class="p">(</span><span class="kt">bytes8</span> <span class="n">_gateKey</span><span class="p">)</span> <span class="k">public</span> <span class="n">gateOne</span> <span class="n">gateTwo</span> <span class="n">gateThree</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">entrant</span> <span class="o">=</span> <span class="n">tx</span><span class="p">.</span><span class="n">origin</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="gateone">gateOne<a href="#gateone" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>  <span class="k">modifier</span> <span class="n">gateOne</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span> <span class="o">!=</span> <span class="n">tx</span><span class="p">.</span><span class="n">origin</span><span class="p">);</span>
    <span class="n">_</span><span class="p">;</span>
  <span class="p">}</span>
</pre></table></code></div></div><p>This is the first gate and as we can see the check is similar to the Telephone challenge we did where we use another contract to act as intermediary.</p><h3 id="gatetwo">gateTwo<a href="#gatetwo" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>  <span class="k">modifier</span> <span class="n">gateTwo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="nb">gasleft</span><span class="p">().</span><span class="n">mod</span><span class="p">(</span><span class="mi">8191</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">_</span><span class="p">;</span>
  <span class="p">}</span>
</pre></table></code></div></div><p>This statement checks if the gas left modulo 8191 is equal to 0 i.e if 8191 divides the gas left this can achieved by simple brute force passing different values of gas until the check passes.</p><h3 id="gatethree">gateThree<a href="#gatethree" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>  <span class="k">modifier</span> <span class="n">gateThree</span><span class="p">(</span><span class="kt">bytes8</span> <span class="n">_gateKey</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">require</span><span class="p">(</span><span class="kt">uint32</span><span class="p">(</span><span class="kt">uint64</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">))</span> <span class="o">==</span> <span class="kt">uint16</span><span class="p">(</span><span class="kt">uint64</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">)),</span> <span class="s">"GatekeeperOne: invalid gateThree part one"</span><span class="p">);</span>
      <span class="nb">require</span><span class="p">(</span><span class="kt">uint32</span><span class="p">(</span><span class="kt">uint64</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">))</span> <span class="o">!=</span> <span class="kt">uint64</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">),</span> <span class="s">"GatekeeperOne: invalid gateThree part two"</span><span class="p">);</span>
      <span class="nb">require</span><span class="p">(</span><span class="kt">uint32</span><span class="p">(</span><span class="kt">uint64</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">))</span> <span class="o">==</span> <span class="kt">uint16</span><span class="p">(</span><span class="n">tx</span><span class="p">.</span><span class="n">origin</span><span class="p">),</span> <span class="s">"GatekeeperOne: invalid gateThree part three"</span><span class="p">);</span>
    <span class="n">_</span><span class="p">;</span>
  <span class="p">}</span>
</pre></table></code></div></div><p>This modifer has 3 seperate checks all based on conversion between different uint types:</p><p>The way uint conversion works is when you convert a uint from higher uint to a lower one the first x bits of the original uint value will be taken when converting from uint to uintx i.e when converting uint64 to uint32 the first 32 bits of the vaiable will be taken.</p><ol><li>check one:<div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>  <span class="k">modifier</span> <span class="n">gateThree</span><span class="p">(</span><span class="kt">bytes8</span> <span class="n">_gateKey</span><span class="p">)</span> <span class="p">{</span>
   <span class="nb">require</span><span class="p">(</span><span class="kt">uint32</span><span class="p">(</span><span class="kt">uint64</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">))</span> <span class="o">==</span> <span class="kt">uint16</span><span class="p">(</span><span class="kt">uint64</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">)),</span> <span class="s">"GatekeeperOne: invalid gateThree part one"</span><span class="p">);</span>
</pre></table></code></div></div><p>this checks matches the lower 32 bits with lower 16 bits of <code class="language-plaintext highlighter-rouge">_gatekey</code> to get them to be equal we can make bits $16-31$ of <code class="language-plaintext highlighter-rouge">_gateKey</code> as 0.</p><li>check two:<div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">require</span><span class="p">(</span><span class="kt">uint32</span><span class="p">(</span><span class="kt">uint64</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">))</span> <span class="o">!=</span> <span class="kt">uint64</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">),</span> <span class="s">"GatekeeperOne: invalid gateThree part two"</span><span class="p">);</span>
</pre></table></code></div></div><p>Here the lower 32 bits is checked with the 64 bits of <code class="language-plaintext highlighter-rouge">_gateKey</code> and as they should not be equal i.e the upper 32 bits of <code class="language-plaintext highlighter-rouge">_gateKey</code> should not be 0. We see in a way this is kinda the opposite of the first check.</p><li>check three:<div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">quire</span><span class="p">(</span><span class="kt">uint32</span><span class="p">(</span><span class="kt">uint64</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">))</span> <span class="o">==</span> <span class="kt">uint16</span><span class="p">(</span><span class="n">tx</span><span class="p">.</span><span class="n">origin</span><span class="p">),</span> <span class="s">"GatekeeperOne: invalid gateThree part three"</span><span class="p">);</span>
</pre></table></code></div></div><p>This check is easy enough to pass all we need to do is ensure when we make the <code class="language-plaintext highlighter-rouge">_gatKey</code> its lower 16 bits are equal to lower 16 bits of the transaction address.</p></ol><p>in the end consolidating all these we need <code class="language-plaintext highlighter-rouge">_gateKey</code> which is 64 bits whose</p><ul><li>first 16 bits are equal to that of tx.origin<li>next 16 bits are 0<li>next 32 bits shouldnot be 0</ul><hr /><h2 id="level-14-gatekeeper-two">Level 14 [GateKeeper Two]<a href="#level-14-gatekeeper-two" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Similar to the above challenge this also requires us to pass 3 gates.</p><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">GatekeeperTwo</span> <span class="p">{</span>

  <span class="kt">address</span> <span class="k">public</span> <span class="n">entrant</span><span class="p">;</span>

  <span class="k">modifier</span> <span class="n">gateOne</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span> <span class="o">!=</span> <span class="n">tx</span><span class="p">.</span><span class="n">origin</span><span class="p">);</span>
    <span class="n">_</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">modifier</span> <span class="n">gateTwo</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">x</span><span class="p">;</span>
    <span class="k">assembly</span> <span class="p">{</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">extcodesize</span><span class="p">(</span><span class="n">caller</span><span class="p">())</span> <span class="p">}</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">_</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">modifier</span> <span class="n">gateThree</span><span class="p">(</span><span class="kt">bytes8</span> <span class="n">_gateKey</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="kt">uint64</span><span class="p">(</span><span class="kt">bytes8</span><span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="n">abi</span><span class="p">.</span><span class="n">encodePacked</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">))))</span> <span class="o">^</span> <span class="kt">uint64</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">)</span> <span class="o">==</span> <span class="kt">uint64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">_</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">enter</span><span class="p">(</span><span class="kt">bytes8</span> <span class="n">_gateKey</span><span class="p">)</span> <span class="k">public</span> <span class="n">gateOne</span> <span class="n">gateTwo</span> <span class="n">gateThree</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">entrant</span> <span class="o">=</span> <span class="n">tx</span><span class="p">.</span><span class="n">origin</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="gate-one">gate One<a href="#gate-one" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>  <span class="k">modifier</span> <span class="n">gateOne</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span> <span class="o">!=</span> <span class="n">tx</span><span class="p">.</span><span class="n">origin</span><span class="p">);</span>
    <span class="n">_</span><span class="p">;</span>
  <span class="p">}</span>
</pre></table></code></div></div><p>This is similar to last challenge and the Telephone challenge.</p><h3 id="gate-two">gate Two<a href="#gate-two" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>  <span class="k">modifier</span> <span class="n">gateTwo</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">x</span><span class="p">;</span>
    <span class="k">assembly</span> <span class="p">{</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">extcodesize</span><span class="p">(</span><span class="n">caller</span><span class="p">())</span> <span class="p">}</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">_</span><span class="p">;</span>
  <span class="p">}</span>
</pre></table></code></div></div><p>This gate checks if the address calling the function on which this modifier is used is smart contract or not. The way it does this is by making use of the extcodesize opcode which returns the length of the code present if any given an address. thus if smart contract is present at that address it will return a number greater than 0 and the check will fail. But since to pass the first check we will need to use a smartcontract.</p><p>To bypass this we can call this contract from the constructor of our custom made smart contract. What this will do is fool the extcodesize opcode as during constrctor intilization the runtime bytecode has not yet been generated and hence the compiler doesnt know the size of the code present in the contract thus it will be 0 at this time. Hence allowing us to pass this check.</p><h3 id="gate-three">gate Three<a href="#gate-three" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre> <span class="k">modifier</span> <span class="n">gateThree</span><span class="p">(</span><span class="kt">bytes8</span> <span class="n">_gateKey</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="kt">uint64</span><span class="p">(</span><span class="kt">bytes8</span><span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="n">abi</span><span class="p">.</span><span class="n">encodePacked</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">))))</span> <span class="o">^</span> <span class="kt">uint64</span><span class="p">(</span><span class="n">_gateKey</span><span class="p">)</span> <span class="o">==</span> <span class="kt">uint64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">_</span><span class="p">;</span>
  <span class="p">}</span>
</pre></table></code></div></div><p>This gate checks if the <code class="language-plaintext highlighter-rouge">_gateKey</code> is correct via a series of xor operations and at the end the xored result should satisfy a condition. But since we know all the variables other than <code class="language-plaintext highlighter-rouge">_gateKey</code> in this equation it is easy to recover it and pass the final check. ___</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blockchain/'>Blockchain</a>, <a href='/categories/ctf-writeups/'>CTF-Writeups</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ethereum/" class="post-tag no-text-decoration" >Ethereum</a> <a href="/tags/solidity/" class="post-tag no-text-decoration" >Solidity</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Ethernaut CTF Writeups - Part 2 - Stryd3r&url=https://vishvesh-rao.github.io/posts/Ethernaut-CTF-Writeups-Part-2/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Ethernaut CTF Writeups - Part 2 - Stryd3r&u=https://vishvesh-rao.github.io/posts/Ethernaut-CTF-Writeups-Part-2/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Ethernaut CTF Writeups - Part 2 - Stryd3r&url=https://vishvesh-rao.github.io/posts/Ethernaut-CTF-Writeups-Part-2/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/STABLEMAGNET-RUGPULL/">STABLEMAGNET SWAP - ANALYSIS OF A RUGPULL</a><li><a href="/posts/Ankr-aBNBc-Token-Exploit/">Ankr aBNBc Token Exploit</a><li><a href="/posts/How-Not-To-Use-Custom-Errors/">How Not To Use Custom Errors</a><li><a href="/posts/Ethernaut-CTF-Writeups-Part-1/">Ethernaut CTF Writeups - Part 1</a><li><a href="/posts/Ethernaut-CTF-Writeups-Part-2/">Ethernaut CTF Writeups - Part 2</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ethereum/">Ethereum</a> <a class="post-tag" href="/tags/solidity/">Solidity</a> <a class="post-tag" href="/tags/crypto/">Crypto</a> <a class="post-tag" href="/tags/rsa/">RSA</a> <a class="post-tag" href="/tags/abnbc/">aBNBc</a> <a class="post-tag" href="/tags/aes-ecb/">AES-ECB</a> <a class="post-tag" href="/tags/bitcoin-protocols/">Bitcoin protocols</a> <a class="post-tag" href="/tags/bsc/">BSC</a> <a class="post-tag" href="/tags/eqn-solving/">eqn solving</a> <a class="post-tag" href="/tags/fwordctf/">FwordCTF</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Ethernaut-CTF-Writeups-Part-1/"><div class="card-body"> <em class="timeago small" date="2022-10-04 20:30:06 +0800" >Oct 4, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Ethernaut CTF Writeups - Part 1</h3><div class="text-muted small"><p> I recently started attempting Ethernaut CTF challenges and it has been a great learning experience solving all these variety of challenges which cover a broad spectrum of topics in...</p></div></div></a></div><div class="card"> <a href="/posts/How-Not-To-Use-Custom-Errors/"><div class="card-body"> <em class="timeago small" date="2022-11-06 20:30:06 +0800" >Nov 6, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How Not To Use Custom Errors</h3><div class="text-muted small"><p> Good Samaritan Overview This challenge focuses on a relatively new feature introduced recently in solidity known as custom errors used for better error handling. The challenge is ...</p></div></div></a></div><div class="card"> <a href="/posts/Bad-Proxies/"><div class="card-body"> <em class="timeago small" date="2022-11-06 20:30:06 +0800" >Nov 6, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Bad Proxies</h3><div class="text-muted small"><p> Motorbike Overview This challenge requires some pre requisites regarding upgradable smart contracts and differentmethods used to achieve this. This challenge is based on the uups...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Ethernaut-CTF-Writeups-Part-1/" class="btn btn-outline-primary" prompt="Older"><p>Ethernaut CTF Writeups - Part 1</p></a> <a href="/posts/How-Not-To-Use-Custom-Errors/" class="btn btn-outline-primary" prompt="Newer"><p>How Not To Use Custom Errors</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://www.linkedin.com/in/vishvesh-rao-847368191">Vishvesh_R</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ethereum/">Ethereum</a> <a class="post-tag" href="/tags/solidity/">Solidity</a> <a class="post-tag" href="/tags/crypto/">Crypto</a> <a class="post-tag" href="/tags/rsa/">RSA</a> <a class="post-tag" href="/tags/abnbc/">aBNBc</a> <a class="post-tag" href="/tags/aes-ecb/">AES-ECB</a> <a class="post-tag" href="/tags/bitcoin-protocols/">Bitcoin protocols</a> <a class="post-tag" href="/tags/bsc/">BSC</a> <a class="post-tag" href="/tags/eqn-solving/">eqn solving</a> <a class="post-tag" href="/tags/fwordctf/">FwordCTF</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
